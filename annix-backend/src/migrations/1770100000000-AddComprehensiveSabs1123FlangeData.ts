import { MigrationInterface, QueryRunner } from 'typeorm';

export class AddComprehensiveSabs1123FlangeData1770100000000 implements MigrationInterface {
  name = 'AddComprehensiveSabs1123FlangeData1770100000000';

  public async up(queryRunner: QueryRunner): Promise<void> {
    console.warn(
      'Adding comprehensive SABS 1123 flange data with all types...',
    );

    // Add flangeTypeId column to flange_dimensions if it doesn't exist
    const columnExists = await queryRunner.query(`
      SELECT column_name FROM information_schema.columns
      WHERE table_name = 'flange_dimensions' AND column_name = 'flangeTypeId'
    `);
    if (columnExists.length === 0) {
      console.warn('Adding flangeTypeId column to flange_dimensions...');
      await queryRunner.query(`
        ALTER TABLE flange_dimensions
        ADD COLUMN "flangeTypeId" integer REFERENCES flange_types(id) ON DELETE SET NULL
      `);
    }

    // First, update or insert SABS 1123 specific flange types
    // SABS 1123 / SANS 1123 codes are different from ASME B16.5
    const sabs1123Types = [
      {
        code: '/1',
        name: 'Backing Ring',
        abbr: 'BR',
        desc: 'Backing ring for rotating/loose flange assemblies',
      },
      {
        code: '/2',
        name: 'Weld Neck',
        abbr: 'WN',
        desc: 'Tapered hub weld neck flange for high integrity joints',
      },
      {
        code: '/3',
        name: 'Slip-On',
        abbr: 'SO',
        desc: 'Slip-on plate flange, most common type',
      },
      {
        code: '/4',
        name: 'Threaded',
        abbr: 'THD',
        desc: 'Threaded/screwed flange for low pressure applications',
      },
      {
        code: '/5',
        name: 'Slip-On Boss',
        abbr: 'SOB',
        desc: 'Slip-on boss flange',
      },
      {
        code: '/6',
        name: 'Socket Weld',
        abbr: 'SW',
        desc: 'Socket weld flange for small bore piping',
      },
      {
        code: '/7',
        name: 'Hubbed Slip-On',
        abbr: 'HSO',
        desc: 'Hubbed slip-on flange with reinforced hub',
      },
      {
        code: '/8',
        name: 'Blind',
        abbr: 'BL',
        desc: 'Blind/blank flange to close pipe ends',
      },
    ];

    for (const ft of sabs1123Types) {
      const existing = await queryRunner.query(
        `SELECT id FROM flange_types WHERE code = '${ft.code}'`,
      );
      if (existing.length === 0) {
        await queryRunner.query(`
          INSERT INTO flange_types (code, name, abbreviation, description, standard_reference)
          VALUES ('${ft.code}', '${ft.name}', '${ft.abbr}', '${ft.desc}', 'SABS 1123 / SANS 1123')
        `);
      } else {
        await queryRunner.query(`
          UPDATE flange_types
          SET name = '${ft.name}', abbreviation = '${ft.abbr}', description = '${ft.desc}'
          WHERE code = '${ft.code}'
        `);
      }
    }

    // Get SABS 1123 standard ID
    const sabs1123Result = await queryRunner.query(
      `SELECT id FROM flange_standards WHERE code = 'SABS 1123'`,
    );
    if (sabs1123Result.length === 0) {
      console.warn('SABS 1123 standard not found, skipping...');
      return;
    }
    const sabs1123Id = sabs1123Result[0].id;

    // Get flange type IDs
    const getTypeId = async (code: string) => {
      const result = await queryRunner.query(
        `SELECT id FROM flange_types WHERE code = '${code}'`,
      );
      return result[0]?.id;
    };

    const typeIds = {
      '/1': await getTypeId('/1'),
      '/2': await getTypeId('/2'),
      '/3': await getTypeId('/3'),
      '/4': await getTypeId('/4'),
      '/5': await getTypeId('/5'),
      '/6': await getTypeId('/6'),
      '/7': await getTypeId('/7'),
      '/8': await getTypeId('/8'),
    };

    // Add pressure classes for different flange types if not exist
    // SABS 1123 pressure classes: 600, 1000, 1600, 2500, 4000 kPa
    const pressureValues = [600, 1000, 1600, 2500, 4000];
    const flangeTypeCodes = ['/1', '/2', '/3', '/4', '/5', '/6', '/7', '/8'];

    for (const pressure of pressureValues) {
      for (const typeCode of flangeTypeCodes) {
        const designation = `${pressure}${typeCode}`;
        const existing = await queryRunner.query(`
          SELECT id FROM flange_pressure_classes
          WHERE designation = '${designation}' AND "standardId" = ${sabs1123Id}
        `);
        if (existing.length === 0) {
          await queryRunner.query(`
            INSERT INTO flange_pressure_classes (designation, "standardId")
            VALUES ('${designation}', ${sabs1123Id})
          `);
        }
      }
    }

    // Helper functions
    const getNominalId = async (nominalMm: number) => {
      const result = await queryRunner.query(`
        SELECT id FROM nominal_outside_diameters
        WHERE nominal_diameter_mm = ${nominalMm}
        LIMIT 1
      `);
      return result[0]?.id;
    };

    const getPressureClassId = async (designation: string) => {
      const result = await queryRunner.query(`
        SELECT id FROM flange_pressure_classes
        WHERE designation = '${designation}' AND "standardId" = ${sabs1123Id}
      `);
      return result[0]?.id;
    };

    const getBoltId = async (designation: string) => {
      if (!designation) return null;
      const result = await queryRunner.query(
        `SELECT id FROM bolts WHERE designation = '${designation}'`,
      );
      return result[0]?.id;
    };

    // Comprehensive SABS 1123 flange dimension data
    // Format: [NB, type, pressureClass, D, b, d4, f, holes, d1, bolt, pcd, mass, boltLength]
    // Data based on SABS 1123 / SANS 1123 standard tables

    // Note: Different types have different thicknesses (b) and weights
    // /2 Weld Neck - thicker, heavier due to tapered hub
    // /3 Slip-On - standard reference
    // /1 Backing Ring - thinner
    // /8 Blind - same drilling but solid (no bore d4)

    const flangeData: Array<
      [
        number,
        string,
        number,
        number,
        number,
        number,
        number,
        number,
        number,
        string | null,
        number,
        number,
        number,
      ]
    > = [
      // ===== 15NB (21.3 OD) =====
      // T600 (PN6)
      [15, '/2', 600, 80, 12, 26, 2, 4, 11, 'M10', 55, 0.4, 35],
      [15, '/3', 600, 80, 10, 26, 2, 4, 11, 'M10', 55, 0.29, 30],
      [15, '/1', 600, 80, 6, 26, 2, 4, 11, 'M10', 55, 0.18, 25],
      [15, '/8', 600, 80, 10, 0, 2, 4, 11, 'M10', 55, 0.44, 30],
      // T1000 (PN10)
      [15, '/2', 1000, 95, 14, 26, 2, 4, 14, 'M12', 65, 0.67, 45],
      [15, '/3', 1000, 95, 10, 26, 2, 4, 14, 'M12', 65, 0.42, 35],
      [15, '/1', 1000, 95, 8, 26, 2, 4, 14, 'M12', 65, 0.32, 30],
      [15, '/8', 1000, 95, 12, 0, 2, 4, 14, 'M12', 65, 0.67, 40],
      // T1600 (PN16)
      [15, '/2', 1600, 95, 14, 26, 2, 4, 14, 'M12', 65, 0.67, 45],
      [15, '/3', 1600, 95, 10, 26, 2, 4, 14, 'M12', 65, 0.42, 35],
      [15, '/1', 1600, 95, 8, 26, 2, 4, 14, 'M12', 65, 0.32, 30],
      [15, '/8', 1600, 95, 14, 0, 2, 4, 14, 'M12', 65, 0.81, 45],
      // T2500 (PN25)
      [15, '/2', 2500, 95, 16, 26, 2, 4, 14, 'M12', 65, 0.75, 50],
      [15, '/3', 2500, 95, 14, 26, 2, 4, 14, 'M12', 65, 0.6, 45],
      [15, '/8', 2500, 95, 16, 0, 2, 4, 14, 'M12', 65, 0.95, 50],
      // T4000 (PN40)
      [15, '/2', 4000, 95, 18, 26, 2, 4, 14, 'M12', 65, 0.85, 55],
      [15, '/3', 4000, 95, 14, 26, 2, 4, 14, 'M12', 65, 0.6, 45],
      [15, '/8', 4000, 95, 18, 0, 2, 4, 14, 'M12', 65, 1.1, 55],

      // ===== 20NB (26.9 OD) =====
      // T600
      [20, '/2', 600, 90, 14, 33, 2, 4, 11, 'M10', 65, 0.59, 40],
      [20, '/3', 600, 90, 10, 33, 2, 4, 11, 'M10', 65, 0.38, 30],
      [20, '/1', 600, 90, 6, 33, 2, 4, 11, 'M10', 65, 0.24, 25],
      [20, '/8', 600, 90, 12, 0, 2, 4, 11, 'M10', 65, 0.59, 35],
      // T1000
      [20, '/2', 1000, 105, 16, 33, 2, 4, 14, 'M12', 75, 0.94, 50],
      [20, '/3', 1000, 105, 10, 33, 2, 4, 14, 'M12', 75, 0.53, 35],
      [20, '/1', 1000, 105, 8, 33, 2, 4, 14, 'M12', 75, 0.4, 30],
      [20, '/8', 1000, 105, 14, 0, 2, 4, 14, 'M12', 75, 0.94, 45],
      // T1600
      [20, '/2', 1600, 105, 16, 33, 2, 4, 14, 'M12', 75, 0.94, 50],
      [20, '/3', 1600, 105, 10, 33, 2, 4, 14, 'M12', 75, 0.53, 35],
      [20, '/1', 1600, 105, 8, 33, 2, 4, 14, 'M12', 75, 0.4, 30],
      [20, '/8', 1600, 105, 16, 0, 2, 4, 14, 'M12', 75, 1.1, 50],
      // T2500
      [20, '/2', 2500, 105, 18, 33, 2, 4, 14, 'M12', 75, 1.1, 55],
      [20, '/3', 2500, 105, 14, 33, 2, 4, 14, 'M12', 75, 0.75, 45],
      [20, '/8', 2500, 105, 18, 0, 2, 4, 14, 'M12', 75, 1.3, 55],
      // T4000
      [20, '/2', 4000, 105, 20, 33, 2, 4, 14, 'M12', 75, 1.25, 60],
      [20, '/3', 4000, 105, 14, 33, 2, 4, 14, 'M12', 75, 0.75, 45],
      [20, '/8', 4000, 105, 20, 0, 2, 4, 14, 'M12', 75, 1.5, 60],

      // ===== 25NB (33.7 OD) =====
      // T600
      [25, '/2', 600, 100, 14, 40, 2, 4, 11, 'M10', 75, 0.72, 40],
      [25, '/3', 600, 100, 10, 40, 2, 4, 11, 'M10', 75, 0.48, 30],
      [25, '/1', 600, 100, 6, 40, 2, 4, 11, 'M10', 75, 0.3, 25],
      [25, '/8', 600, 100, 12, 0, 2, 4, 11, 'M10', 75, 0.72, 35],
      // T1000
      [25, '/2', 1000, 115, 16, 40, 2, 4, 14, 'M12', 85, 1.11, 50],
      [25, '/3', 1000, 115, 10, 40, 2, 4, 14, 'M12', 85, 0.63, 35],
      [25, '/1', 1000, 115, 8, 40, 2, 4, 14, 'M12', 85, 0.48, 30],
      [25, '/8', 1000, 115, 14, 0, 2, 4, 14, 'M12', 85, 1.11, 45],
      // T1600
      [25, '/2', 1600, 115, 16, 40, 2, 4, 14, 'M12', 85, 1.11, 50],
      [25, '/3', 1600, 115, 10, 40, 2, 4, 14, 'M12', 85, 0.63, 35],
      [25, '/1', 1600, 115, 8, 40, 2, 4, 14, 'M12', 85, 0.48, 30],
      [25, '/8', 1600, 115, 16, 0, 2, 4, 14, 'M12', 85, 1.3, 50],
      // T2500
      [25, '/2', 2500, 115, 20, 40, 2, 4, 14, 'M12', 85, 1.45, 60],
      [25, '/3', 2500, 115, 16, 40, 2, 4, 14, 'M12', 85, 1.07, 50],
      [25, '/8', 2500, 115, 20, 0, 2, 4, 14, 'M12', 85, 1.5, 60],
      // T4000
      [25, '/2', 4000, 115, 22, 40, 2, 4, 14, 'M12', 85, 1.6, 65],
      [25, '/3', 4000, 115, 16, 40, 2, 4, 14, 'M12', 85, 1.07, 50],
      [25, '/8', 4000, 115, 22, 0, 2, 4, 14, 'M12', 85, 1.8, 65],

      // ===== 32NB (42.4 OD) =====
      // T600
      [32, '/2', 600, 120, 14, 50, 2, 4, 14, 'M12', 90, 0.97, 40],
      [32, '/3', 600, 120, 10, 50, 2, 4, 14, 'M12', 90, 0.65, 30],
      [32, '/1', 600, 120, 6, 50, 2, 4, 14, 'M12', 90, 0.4, 25],
      [32, '/8', 600, 120, 14, 0, 2, 4, 14, 'M12', 90, 1.16, 40],
      // T1000
      [32, '/2', 1000, 140, 18, 50, 2, 4, 18, 'M16', 100, 1.82, 55],
      [32, '/3', 1000, 140, 12, 50, 2, 4, 18, 'M16', 100, 1.1, 40],
      [32, '/1', 1000, 140, 10, 50, 2, 4, 18, 'M16', 100, 0.88, 35],
      [32, '/8', 1000, 140, 16, 0, 2, 4, 18, 'M16', 100, 1.82, 50],
      // T1600
      [32, '/2', 1600, 140, 18, 50, 2, 4, 18, 'M16', 100, 1.82, 55],
      [32, '/3', 1600, 140, 12, 50, 2, 4, 18, 'M16', 100, 1.1, 40],
      [32, '/1', 1600, 140, 10, 50, 2, 4, 18, 'M16', 100, 0.88, 35],
      [32, '/8', 1600, 140, 18, 0, 2, 4, 18, 'M16', 100, 2.2, 55],
      // T2500
      [32, '/2', 2500, 140, 22, 50, 2, 4, 18, 'M16', 100, 2.4, 65],
      [32, '/3', 2500, 140, 16, 50, 2, 4, 18, 'M16', 100, 1.55, 50],
      [32, '/8', 2500, 140, 22, 0, 2, 4, 18, 'M16', 100, 2.6, 65],
      // T4000
      [32, '/2', 4000, 140, 26, 50, 2, 4, 18, 'M16', 100, 2.9, 75],
      [32, '/3', 4000, 140, 18, 50, 2, 4, 18, 'M16', 100, 1.8, 55],
      [32, '/8', 4000, 140, 26, 0, 2, 4, 18, 'M16', 100, 3.0, 75],

      // ===== 40NB (48.3 OD) =====
      // T600
      [40, '/2', 600, 130, 14, 56, 2, 4, 14, 'M12', 100, 1.16, 40],
      [40, '/3', 600, 130, 10, 56, 2, 4, 14, 'M12', 100, 0.75, 30],
      [40, '/1', 600, 130, 6, 56, 2, 4, 14, 'M12', 100, 0.46, 25],
      [40, '/8', 600, 130, 14, 0, 2, 4, 14, 'M12', 100, 1.35, 40],
      // T1000
      [40, '/2', 1000, 150, 18, 56, 2, 4, 18, 'M16', 110, 2.08, 55],
      [40, '/3', 1000, 150, 12, 56, 2, 4, 18, 'M16', 110, 1.25, 40],
      [40, '/1', 1000, 150, 10, 56, 2, 4, 18, 'M16', 110, 1.0, 35],
      [40, '/8', 1000, 150, 16, 0, 2, 4, 18, 'M16', 110, 2.08, 50],
      // T1600
      [40, '/2', 1600, 150, 18, 56, 2, 4, 18, 'M16', 110, 2.08, 55],
      [40, '/3', 1600, 150, 12, 56, 2, 4, 18, 'M16', 110, 1.25, 40],
      [40, '/1', 1600, 150, 10, 56, 2, 4, 18, 'M16', 110, 1.0, 35],
      [40, '/8', 1600, 150, 18, 0, 2, 4, 18, 'M16', 110, 2.5, 55],
      // T2500
      [40, '/2', 2500, 150, 22, 56, 2, 4, 18, 'M16', 110, 2.7, 65],
      [40, '/3', 2500, 150, 16, 56, 2, 4, 18, 'M16', 110, 1.8, 50],
      [40, '/8', 2500, 150, 22, 0, 2, 4, 18, 'M16', 110, 3.0, 65],
      // T4000
      [40, '/2', 4000, 150, 26, 56, 2, 4, 18, 'M16', 110, 3.3, 75],
      [40, '/3', 4000, 150, 18, 56, 2, 4, 18, 'M16', 110, 2.1, 55],
      [40, '/8', 4000, 150, 26, 0, 2, 4, 18, 'M16', 110, 3.5, 75],

      // ===== 50NB (60.3 OD) =====
      // T600
      [50, '/2', 600, 140, 16, 66, 3, 4, 14, 'M12', 110, 1.48, 45],
      [50, '/3', 600, 140, 10, 66, 3, 4, 14, 'M12', 110, 0.9, 30],
      [50, '/1', 600, 140, 8, 66, 3, 4, 14, 'M12', 110, 0.7, 25],
      [50, '/8', 600, 140, 14, 0, 3, 4, 14, 'M12', 110, 1.9, 40],
      // T1000
      [50, '/2', 1000, 165, 20, 66, 3, 4, 18, 'M16', 125, 2.73, 60],
      [50, '/3', 1000, 165, 12, 66, 3, 4, 18, 'M16', 125, 1.5, 40],
      [50, '/1', 1000, 165, 10, 66, 3, 4, 18, 'M16', 125, 1.2, 35],
      [50, '/8', 1000, 165, 18, 0, 3, 4, 18, 'M16', 125, 2.7, 55],
      // T1600
      [50, '/2', 1600, 165, 20, 66, 3, 4, 18, 'M16', 125, 2.73, 60],
      [50, '/3', 1600, 165, 12, 66, 3, 4, 18, 'M16', 125, 1.5, 40],
      [50, '/1', 1600, 165, 10, 66, 3, 4, 18, 'M16', 125, 1.2, 35],
      [50, '/8', 1600, 165, 20, 0, 3, 4, 18, 'M16', 125, 3.3, 60],
      // T2500
      [50, '/2', 2500, 165, 26, 66, 3, 4, 18, 'M16', 125, 3.8, 75],
      [50, '/3', 2500, 165, 18, 66, 3, 4, 18, 'M16', 125, 2.4, 55],
      [50, '/8', 2500, 165, 26, 0, 3, 4, 18, 'M16', 125, 4.0, 75],
      // T4000
      [50, '/2', 4000, 165, 30, 66, 3, 4, 18, 'M16', 125, 4.6, 85],
      [50, '/3', 4000, 165, 20, 66, 3, 4, 18, 'M16', 125, 2.8, 60],
      [50, '/8', 4000, 165, 30, 0, 3, 4, 18, 'M16', 125, 4.8, 85],

      // ===== 65NB (76.1 OD) =====
      // T600
      [65, '/2', 600, 160, 16, 82, 3, 4, 14, 'M12', 130, 1.86, 45],
      [65, '/3', 600, 160, 10, 82, 3, 4, 14, 'M12', 130, 1.1, 30],
      [65, '/1', 600, 160, 8, 82, 3, 4, 14, 'M12', 130, 0.85, 25],
      [65, '/8', 600, 160, 14, 0, 3, 4, 14, 'M12', 130, 2.5, 40],
      // T1000
      [65, '/2', 1000, 185, 22, 82, 3, 8, 18, 'M16', 145, 3.48, 65],
      [65, '/3', 1000, 185, 12, 82, 3, 8, 18, 'M16', 145, 1.8, 40],
      [65, '/1', 1000, 185, 10, 82, 3, 8, 18, 'M16', 145, 1.45, 35],
      [65, '/8', 1000, 185, 18, 0, 3, 8, 18, 'M16', 145, 3.5, 55],
      // T1600
      [65, '/2', 1600, 185, 22, 82, 3, 8, 18, 'M16', 145, 3.48, 65],
      [65, '/3', 1600, 185, 12, 82, 3, 8, 18, 'M16', 145, 1.8, 40],
      [65, '/1', 1600, 185, 10, 82, 3, 8, 18, 'M16', 145, 1.45, 35],
      [65, '/8', 1600, 185, 22, 0, 3, 8, 18, 'M16', 145, 4.2, 65],
      // T2500
      [65, '/2', 2500, 185, 28, 82, 3, 8, 18, 'M16', 145, 4.8, 80],
      [65, '/3', 2500, 185, 20, 82, 3, 8, 18, 'M16', 145, 3.1, 60],
      [65, '/8', 2500, 185, 28, 0, 3, 8, 18, 'M16', 145, 5.5, 80],
      // T4000
      [65, '/2', 4000, 185, 34, 82, 3, 8, 18, 'M16', 145, 6.2, 95],
      [65, '/3', 4000, 185, 24, 82, 3, 8, 18, 'M16', 145, 4.0, 70],
      [65, '/8', 4000, 185, 34, 0, 3, 8, 18, 'M16', 145, 6.5, 95],

      // ===== 80NB (88.9 OD) =====
      // T600
      [80, '/2', 600, 190, 18, 95, 3, 4, 18, 'M16', 150, 2.95, 55],
      [80, '/3', 600, 190, 12, 95, 3, 4, 18, 'M16', 150, 1.8, 40],
      [80, '/1', 600, 190, 10, 95, 3, 4, 18, 'M16', 150, 1.45, 35],
      [80, '/8', 600, 190, 16, 0, 3, 4, 18, 'M16', 150, 3.8, 50],
      // T1000
      [80, '/2', 1000, 200, 22, 95, 3, 8, 18, 'M16', 160, 4.32, 65],
      [80, '/3', 1000, 200, 14, 95, 3, 8, 18, 'M16', 160, 2.5, 45],
      [80, '/1', 1000, 200, 12, 95, 3, 8, 18, 'M16', 160, 2.1, 40],
      [80, '/8', 1000, 200, 18, 0, 3, 8, 18, 'M16', 160, 4.5, 55],
      // T1600
      [80, '/2', 1600, 200, 22, 95, 3, 8, 18, 'M16', 160, 4.32, 65],
      [80, '/3', 1600, 200, 14, 95, 3, 8, 18, 'M16', 160, 2.5, 45],
      [80, '/1', 1600, 200, 12, 95, 3, 8, 18, 'M16', 160, 2.1, 40],
      [80, '/8', 1600, 200, 22, 0, 3, 8, 18, 'M16', 160, 5.4, 65],
      // T2500
      [80, '/2', 2500, 200, 28, 95, 3, 8, 18, 'M16', 160, 6.0, 80],
      [80, '/3', 2500, 200, 20, 95, 3, 8, 18, 'M16', 160, 4.0, 60],
      [80, '/8', 2500, 200, 28, 0, 3, 8, 18, 'M16', 160, 7.0, 80],
      // T4000
      [80, '/2', 4000, 200, 34, 95, 3, 8, 18, 'M16', 160, 7.8, 95],
      [80, '/3', 4000, 200, 24, 95, 3, 8, 18, 'M16', 160, 5.2, 70],
      [80, '/8', 4000, 200, 34, 0, 3, 8, 18, 'M16', 160, 8.5, 95],

      // ===== 100NB (114.3 OD) =====
      // T600
      [100, '/2', 600, 210, 18, 121, 3, 8, 18, 'M16', 170, 3.26, 55],
      [100, '/3', 600, 210, 12, 121, 3, 8, 18, 'M16', 170, 2.0, 40],
      [100, '/1', 600, 210, 10, 121, 3, 8, 18, 'M16', 170, 1.6, 35],
      [100, '/8', 600, 210, 16, 0, 3, 8, 18, 'M16', 170, 4.8, 50],
      // T1000
      [100, '/2', 1000, 220, 24, 121, 3, 8, 18, 'M16', 180, 6.07, 70],
      [100, '/3', 1000, 220, 14, 121, 3, 8, 18, 'M16', 180, 3.3, 45],
      [100, '/1', 1000, 220, 12, 121, 3, 8, 18, 'M16', 180, 2.75, 40],
      [100, '/8', 1000, 220, 20, 0, 3, 8, 18, 'M16', 180, 5.8, 60],
      // T1600
      [100, '/2', 1600, 235, 26, 121, 3, 8, 22, 'M20', 190, 7.2, 75],
      [100, '/3', 1600, 235, 16, 121, 3, 8, 22, 'M20', 190, 4.2, 50],
      [100, '/1', 1600, 235, 14, 121, 3, 8, 22, 'M20', 190, 3.6, 45],
      [100, '/8', 1600, 235, 22, 0, 3, 8, 22, 'M20', 190, 7.2, 65],
      // T2500
      [100, '/2', 2500, 250, 32, 121, 3, 8, 26, 'M24', 200, 9.5, 90],
      [100, '/3', 2500, 250, 22, 121, 3, 8, 26, 'M24', 200, 6.2, 65],
      [100, '/8', 2500, 250, 32, 0, 3, 8, 26, 'M24', 200, 9.5, 90],
      // T4000
      [100, '/2', 4000, 265, 40, 121, 3, 8, 30, 'M27', 212, 12.0, 110],
      [100, '/3', 4000, 265, 28, 121, 3, 8, 30, 'M27', 212, 8.0, 80],
      [100, '/8', 4000, 265, 40, 0, 3, 8, 30, 'M27', 212, 12.0, 110],

      // ===== 150NB (168.3 OD) =====
      // T600
      [150, '/2', 600, 265, 20, 176, 3, 8, 18, 'M16', 225, 4.76, 60],
      [150, '/3', 600, 265, 12, 176, 3, 8, 18, 'M16', 225, 2.8, 40],
      [150, '/1', 600, 265, 10, 176, 3, 8, 18, 'M16', 225, 2.25, 35],
      [150, '/8', 600, 265, 18, 0, 3, 8, 18, 'M16', 225, 7.5, 55],
      // T1000
      [150, '/2', 1000, 285, 26, 176, 3, 8, 22, 'M20', 240, 10.3, 75],
      [150, '/3', 1000, 285, 16, 176, 3, 8, 22, 'M20', 240, 5.8, 50],
      [150, '/1', 1000, 285, 14, 176, 3, 8, 22, 'M20', 240, 5.0, 45],
      [150, '/8', 1000, 285, 22, 0, 3, 8, 22, 'M20', 240, 10.0, 65],
      // T1600
      [150, '/2', 1600, 300, 30, 176, 3, 8, 26, 'M24', 250, 13.2, 85],
      [150, '/3', 1600, 300, 18, 176, 3, 8, 26, 'M24', 250, 7.5, 55],
      [150, '/1', 1600, 300, 16, 176, 3, 8, 26, 'M24', 250, 6.6, 50],
      [150, '/8', 1600, 300, 26, 0, 3, 8, 26, 'M24', 250, 13.2, 75],
      // T2500
      [150, '/2', 2500, 340, 42, 176, 4, 12, 30, 'M27', 280, 20.0, 115],
      [150, '/3', 2500, 340, 28, 176, 4, 12, 30, 'M27', 280, 12.5, 80],
      [150, '/8', 2500, 340, 42, 0, 4, 12, 30, 'M27', 280, 18.0, 115],
      // T4000
      [150, '/2', 4000, 355, 52, 176, 4, 12, 33, 'M30', 295, 26.0, 140],
      [150, '/3', 4000, 355, 36, 176, 4, 12, 33, 'M30', 295, 17.0, 100],
      [150, '/8', 4000, 355, 52, 0, 4, 12, 33, 'M30', 295, 23.0, 140],

      // ===== 200NB (219.1 OD) =====
      // T600
      [200, '/2', 600, 320, 22, 229, 3, 8, 18, 'M16', 280, 6.88, 65],
      [200, '/3', 600, 320, 14, 229, 3, 8, 18, 'M16', 280, 4.2, 45],
      [200, '/1', 600, 320, 12, 229, 3, 8, 18, 'M16', 280, 3.5, 40],
      [200, '/8', 600, 320, 20, 0, 3, 8, 18, 'M16', 280, 11.5, 60],
      // T1000
      [200, '/2', 1000, 340, 30, 229, 3, 12, 22, 'M20', 295, 17.9, 85],
      [200, '/3', 1000, 340, 18, 229, 3, 12, 22, 'M20', 295, 9.7, 55],
      [200, '/1', 1000, 340, 16, 229, 3, 12, 22, 'M20', 295, 8.5, 50],
      [200, '/8', 1000, 340, 26, 0, 3, 12, 22, 'M20', 295, 16.5, 75],
      // T1600
      [200, '/2', 1600, 360, 36, 229, 3, 12, 26, 'M24', 310, 24.0, 100],
      [200, '/3', 1600, 360, 22, 229, 3, 12, 26, 'M24', 310, 14.0, 65],
      [200, '/1', 1600, 360, 20, 229, 3, 12, 26, 'M24', 310, 12.5, 60],
      [200, '/8', 1600, 360, 32, 0, 3, 12, 26, 'M24', 310, 20.0, 90],
      // T2500
      [200, '/2', 2500, 405, 50, 229, 4, 12, 33, 'M30', 345, 37.0, 135],
      [200, '/3', 2500, 405, 34, 229, 4, 12, 33, 'M30', 345, 24.0, 95],
      [200, '/8', 2500, 405, 50, 0, 4, 12, 33, 'M30', 345, 30.0, 135],
      // T4000
      [200, '/2', 4000, 430, 62, 229, 4, 12, 36, 'M33', 365, 50.0, 165],
      [200, '/3', 4000, 430, 42, 229, 4, 12, 36, 'M33', 365, 32.0, 115],
      [200, '/8', 4000, 430, 62, 0, 4, 12, 36, 'M33', 365, 40.0, 165],

      // ===== 250NB (273.0 OD) =====
      // T600
      [250, '/2', 600, 375, 24, 284, 3, 12, 18, 'M16', 335, 8.92, 70],
      [250, '/3', 600, 375, 16, 284, 3, 12, 18, 'M16', 335, 5.6, 50],
      [250, '/1', 600, 375, 14, 284, 3, 12, 18, 'M16', 335, 4.8, 45],
      [250, '/8', 600, 375, 22, 0, 3, 12, 18, 'M16', 335, 17.0, 65],
      // T1000
      [250, '/2', 1000, 405, 34, 284, 3, 12, 26, 'M24', 355, 29.3, 95],
      [250, '/3', 1000, 405, 20, 284, 3, 12, 26, 'M24', 355, 15.9, 60],
      [250, '/1', 1000, 405, 18, 284, 3, 12, 26, 'M24', 355, 14.1, 55],
      [250, '/8', 1000, 405, 30, 0, 3, 12, 26, 'M24', 355, 25.0, 85],
      // T1600
      [250, '/2', 1600, 425, 42, 284, 3, 12, 30, 'M27', 370, 38.0, 115],
      [250, '/3', 1600, 425, 26, 284, 3, 12, 30, 'M27', 370, 22.5, 75],
      [250, '/1', 1600, 425, 24, 284, 3, 12, 30, 'M27', 370, 20.5, 70],
      [250, '/8', 1600, 425, 38, 0, 3, 12, 30, 'M27', 370, 32.0, 105],
      // T2500
      [250, '/2', 2500, 470, 56, 284, 4, 12, 36, 'M33', 410, 55.0, 150],
      [250, '/3', 2500, 470, 38, 284, 4, 12, 36, 'M33', 410, 35.0, 105],
      [250, '/8', 2500, 470, 56, 0, 4, 12, 36, 'M33', 410, 48.0, 150],
      // T4000
      [250, '/2', 4000, 505, 70, 284, 4, 12, 39, 'M36', 440, 75.0, 185],
      [250, '/3', 4000, 505, 48, 284, 4, 12, 39, 'M36', 440, 48.0, 130],
      [250, '/8', 4000, 505, 70, 0, 4, 12, 39, 'M36', 440, 65.0, 185],

      // ===== 300NB (323.9 OD) =====
      // T600
      [300, '/2', 600, 440, 26, 337, 4, 12, 22, 'M20', 395, 11.9, 75],
      [300, '/3', 600, 440, 16, 337, 4, 12, 22, 'M20', 395, 7.0, 50],
      [300, '/1', 600, 440, 14, 337, 4, 12, 22, 'M20', 395, 6.0, 45],
      [300, '/8', 600, 440, 24, 0, 4, 12, 22, 'M20', 395, 24.0, 70],
      // T1000
      [300, '/2', 1000, 460, 38, 337, 4, 12, 26, 'M24', 410, 43.8, 105],
      [300, '/3', 1000, 460, 22, 337, 4, 12, 26, 'M24', 410, 23.5, 65],
      [300, '/1', 1000, 460, 20, 337, 4, 12, 26, 'M24', 410, 21.0, 60],
      [300, '/8', 1000, 460, 34, 0, 4, 12, 26, 'M24', 410, 36.0, 95],
      // T1600
      [300, '/2', 1600, 485, 48, 337, 4, 12, 30, 'M27', 430, 60.0, 130],
      [300, '/3', 1600, 485, 30, 337, 4, 12, 30, 'M27', 430, 35.0, 85],
      [300, '/1', 1600, 485, 28, 337, 4, 12, 30, 'M27', 430, 32.5, 80],
      [300, '/8', 1600, 485, 44, 0, 4, 12, 30, 'M27', 430, 48.0, 120],
      // T2500
      [300, '/2', 2500, 535, 64, 337, 4, 16, 36, 'M33', 475, 85.0, 170],
      [300, '/3', 2500, 535, 44, 337, 4, 16, 36, 'M33', 475, 55.0, 120],
      [300, '/8', 2500, 535, 64, 0, 4, 16, 36, 'M33', 475, 72.0, 170],
      // T4000
      [300, '/2', 4000, 585, 82, 337, 4, 16, 42, 'M39', 515, 115.0, 215],
      [300, '/3', 4000, 585, 56, 337, 4, 16, 42, 'M39', 515, 75.0, 150],
      [300, '/8', 4000, 585, 82, 0, 4, 16, 42, 'M39', 515, 100.0, 215],

      // ===== 350NB (355.6 OD) =====
      // T600
      [350, '/2', 600, 490, 28, 370, 4, 12, 22, 'M20', 445, 16.8, 80],
      [350, '/3', 600, 490, 18, 370, 4, 12, 22, 'M20', 445, 10.3, 55],
      [350, '/1', 600, 490, 16, 370, 4, 12, 22, 'M20', 445, 9.0, 50],
      [350, '/8', 600, 490, 26, 0, 4, 12, 22, 'M20', 445, 33.0, 75],
      // T1000
      [350, '/2', 1000, 520, 42, 370, 4, 16, 26, 'M24', 470, 61.5, 115],
      [350, '/3', 1000, 520, 26, 370, 4, 16, 26, 'M24', 470, 35.5, 75],
      [350, '/1', 1000, 520, 24, 370, 4, 16, 26, 'M24', 470, 32.5, 70],
      [350, '/8', 1000, 520, 38, 0, 4, 16, 26, 'M24', 470, 48.0, 105],
      // T1600
      [350, '/2', 1600, 555, 54, 370, 4, 16, 33, 'M30', 495, 85.0, 145],
      [350, '/3', 1600, 555, 34, 370, 4, 16, 33, 'M30', 495, 50.0, 95],
      [350, '/1', 1600, 555, 32, 370, 4, 16, 33, 'M30', 495, 46.5, 90],
      [350, '/8', 1600, 555, 50, 0, 4, 16, 33, 'M30', 495, 65.0, 135],
      // T2500
      [350, '/2', 2500, 600, 72, 370, 4, 16, 39, 'M36', 535, 115.0, 190],
      [350, '/3', 2500, 600, 50, 370, 4, 16, 39, 'M36', 535, 75.0, 135],
      [350, '/8', 2500, 600, 72, 0, 4, 16, 39, 'M36', 535, 100.0, 190],

      // ===== 400NB (406.4 OD) =====
      // T600
      [400, '/2', 600, 540, 30, 422, 4, 16, 22, 'M20', 495, 19.8, 85],
      [400, '/3', 600, 540, 18, 422, 4, 16, 22, 'M20', 495, 11.6, 55],
      [400, '/1', 600, 540, 16, 422, 4, 16, 22, 'M20', 495, 10.2, 50],
      [400, '/8', 600, 540, 28, 0, 4, 16, 22, 'M20', 495, 43.0, 80],
      // T1000
      [400, '/2', 1000, 580, 46, 422, 4, 16, 30, 'M27', 525, 88.5, 125],
      [400, '/3', 1000, 580, 28, 422, 4, 16, 30, 'M27', 525, 50.0, 80],
      [400, '/1', 1000, 580, 26, 422, 4, 16, 30, 'M27', 525, 46.0, 75],
      [400, '/8', 1000, 580, 42, 0, 4, 16, 30, 'M27', 525, 62.0, 115],
      // T1600
      [400, '/2', 1600, 620, 60, 422, 4, 16, 36, 'M33', 555, 120.0, 160],
      [400, '/3', 1600, 620, 38, 422, 4, 16, 36, 'M33', 555, 70.0, 105],
      [400, '/1', 1600, 620, 36, 422, 4, 16, 36, 'M33', 555, 65.5, 100],
      [400, '/8', 1600, 620, 56, 0, 4, 16, 36, 'M33', 555, 85.0, 150],
      // T2500
      [400, '/2', 2500, 670, 82, 422, 4, 16, 42, 'M39', 600, 165.0, 215],
      [400, '/3', 2500, 670, 56, 422, 4, 16, 42, 'M39', 600, 105.0, 150],
      [400, '/8', 2500, 670, 82, 0, 4, 16, 42, 'M39', 600, 135.0, 215],

      // ===== 450NB (457.2 OD) =====
      // T600
      [450, '/2', 600, 595, 32, 474, 4, 16, 26, 'M24', 550, 24.0, 90],
      [450, '/3', 600, 595, 20, 474, 4, 16, 26, 'M24', 550, 14.5, 60],
      [450, '/1', 600, 595, 18, 474, 4, 16, 26, 'M24', 550, 12.9, 55],
      [450, '/8', 600, 595, 30, 0, 4, 16, 26, 'M24', 550, 54.0, 85],
      // T1000
      [450, '/2', 1000, 640, 50, 474, 4, 20, 30, 'M27', 585, 110.0, 135],
      [450, '/3', 1000, 640, 32, 474, 4, 20, 30, 'M27', 585, 65.0, 90],
      [450, '/1', 1000, 640, 30, 474, 4, 20, 30, 'M27', 585, 60.5, 85],
      [450, '/8', 1000, 640, 46, 0, 4, 20, 30, 'M27', 585, 78.0, 125],
      // T1600
      [450, '/2', 1600, 685, 66, 474, 4, 20, 36, 'M33', 620, 155.0, 175],
      [450, '/3', 1600, 685, 42, 474, 4, 20, 36, 'M33', 620, 90.0, 115],
      [450, '/1', 1600, 685, 40, 474, 4, 20, 36, 'M33', 620, 85.0, 110],
      [450, '/8', 1600, 685, 62, 0, 4, 20, 36, 'M33', 620, 108.0, 165],
      // T2500
      [450, '/2', 2500, 745, 92, 474, 4, 20, 45, 'M42', 680, 220.0, 240],
      [450, '/3', 2500, 745, 64, 474, 4, 20, 45, 'M42', 680, 140.0, 170],
      [450, '/8', 2500, 745, 92, 0, 4, 20, 45, 'M42', 680, 175.0, 240],

      // ===== 500NB (508.0 OD) =====
      // T600 (PN6) - CORRECTED: d1=22, bolt=M20
      [500, '/2', 600, 645, 28, 525, 4, 20, 22, 'M20', 600, 22.0, 70],
      [500, '/3', 600, 645, 22, 525, 4, 20, 22, 'M20', 600, 16.5, 65],
      [500, '/1', 600, 645, 18, 525, 4, 20, 22, 'M20', 600, 14.0, 55],
      [500, '/8', 600, 645, 26, 0, 4, 20, 22, 'M20', 600, 52.0, 70],
      // T1000 (PN10) - CORRECTED: D=670, PCD=620, d1=26, bolt=M24
      [500, '/2', 1000, 670, 44, 525, 4, 20, 26, 'M24', 620, 38.0, 95],
      [500, '/3', 1000, 670, 32, 525, 4, 20, 26, 'M24', 620, 28.0, 80],
      [500, '/1', 1000, 670, 28, 525, 4, 20, 26, 'M24', 620, 24.0, 70],
      [500, '/8', 1000, 670, 38, 0, 4, 20, 26, 'M24', 620, 60.0, 95],
      // T1600 (PN16) - CORRECTED: D=715, PCD=650, d1=33, bolt=M30
      [500, '/2', 1600, 715, 58, 525, 4, 20, 33, 'M30', 650, 65.0, 125],
      [500, '/3', 1600, 715, 44, 525, 4, 20, 33, 'M30', 650, 48.0, 110],
      [500, '/1', 1600, 715, 40, 525, 4, 20, 33, 'M30', 650, 42.0, 100],
      [500, '/8', 1600, 715, 52, 0, 4, 20, 33, 'M30', 650, 85.0, 125],
      // T2500 (PN25) - CORRECTED: D=730, PCD=660, d1=36, bolt=M33
      [500, '/2', 2500, 730, 78, 525, 4, 20, 36, 'M33', 660, 95.0, 165],
      [500, '/3', 2500, 730, 62, 525, 4, 20, 36, 'M33', 660, 72.0, 145],
      [500, '/1', 2500, 730, 56, 525, 4, 20, 36, 'M33', 660, 65.0, 135],
      [500, '/8', 2500, 730, 72, 0, 4, 20, 36, 'M33', 660, 115.0, 165],
      // T4000 (PN40) - ADDED: D=755, PCD=670, d1=42, bolt=M39
      [500, '/2', 4000, 755, 98, 525, 4, 20, 42, 'M39', 670, 135.0, 205],
      [500, '/3', 4000, 755, 80, 525, 4, 20, 42, 'M39', 670, 105.0, 185],
      [500, '/1', 4000, 755, 74, 525, 4, 20, 42, 'M39', 670, 95.0, 175],
      [500, '/8', 4000, 755, 92, 0, 4, 20, 42, 'M39', 670, 155.0, 205],

      // ===== 600NB (609.6 OD) =====
      // T600
      [600, '/2', 600, 755, 38, 630, 4, 20, 30, 'M27', 705, 34.7, 105],
      [600, '/3', 600, 755, 24, 630, 4, 20, 30, 'M27', 705, 21.3, 70],
      [600, '/1', 600, 755, 22, 630, 4, 20, 30, 'M27', 705, 19.4, 65],
      [600, '/8', 600, 755, 36, 0, 4, 20, 30, 'M27', 705, 85.0, 100],
      // T1000
      [600, '/2', 1000, 840, 62, 630, 4, 20, 36, 'M33', 770, 200.0, 165],
      [600, '/3', 1000, 840, 40, 630, 4, 20, 36, 'M33', 770, 120.0, 110],
      [600, '/1', 1000, 840, 38, 630, 4, 20, 36, 'M33', 770, 113.0, 105],
      [600, '/8', 1000, 840, 58, 0, 4, 20, 36, 'M33', 770, 135.0, 155],
      // T1600
      [600, '/2', 1600, 890, 82, 630, 4, 20, 42, 'M39', 810, 280.0, 215],
      [600, '/3', 1600, 890, 52, 630, 4, 20, 42, 'M39', 810, 165.0, 140],
      [600, '/1', 1600, 890, 50, 630, 4, 20, 42, 'M39', 810, 157.5, 135],
      [600, '/8', 1600, 890, 78, 0, 4, 20, 42, 'M39', 810, 195.0, 205],

      // ===== TYPE /4 THREADED FLANGES =====
      // Threaded flanges typically available up to 100NB
      // T600 (PN6)
      [15, '/4', 600, 80, 10, 26, 2, 4, 11, 'M10', 55, 0.3, 30],
      [20, '/4', 600, 90, 10, 33, 2, 4, 11, 'M10', 65, 0.4, 30],
      [25, '/4', 600, 100, 10, 40, 2, 4, 11, 'M10', 75, 0.5, 30],
      [32, '/4', 600, 120, 10, 50, 2, 4, 14, 'M12', 90, 0.68, 30],
      [40, '/4', 600, 130, 10, 56, 2, 4, 14, 'M12', 100, 0.78, 30],
      [50, '/4', 600, 140, 10, 66, 3, 4, 14, 'M12', 110, 0.92, 30],
      [65, '/4', 600, 160, 10, 82, 3, 4, 14, 'M12', 130, 1.15, 30],
      [80, '/4', 600, 190, 12, 95, 3, 4, 18, 'M16', 150, 1.85, 40],
      [100, '/4', 600, 210, 12, 121, 3, 8, 18, 'M16', 170, 2.1, 40],
      // T1000 (PN10)
      [15, '/4', 1000, 95, 10, 26, 2, 4, 14, 'M12', 65, 0.45, 35],
      [20, '/4', 1000, 105, 10, 33, 2, 4, 14, 'M12', 75, 0.55, 35],
      [25, '/4', 1000, 115, 10, 40, 2, 4, 14, 'M12', 85, 0.66, 35],
      [32, '/4', 1000, 140, 12, 50, 2, 4, 18, 'M16', 100, 1.15, 40],
      [40, '/4', 1000, 150, 12, 56, 2, 4, 18, 'M16', 110, 1.3, 40],
      [50, '/4', 1000, 165, 12, 66, 3, 4, 18, 'M16', 125, 1.55, 40],
      [65, '/4', 1000, 185, 12, 82, 3, 8, 18, 'M16', 145, 1.88, 40],
      [80, '/4', 1000, 200, 14, 95, 3, 8, 18, 'M16', 160, 2.55, 45],
      [100, '/4', 1000, 220, 14, 121, 3, 8, 18, 'M16', 180, 3.4, 45],
      // T1600 (PN16)
      [15, '/4', 1600, 95, 10, 26, 2, 4, 14, 'M12', 65, 0.45, 35],
      [20, '/4', 1600, 105, 10, 33, 2, 4, 14, 'M12', 75, 0.55, 35],
      [25, '/4', 1600, 115, 10, 40, 2, 4, 14, 'M12', 85, 0.66, 35],
      [32, '/4', 1600, 140, 12, 50, 2, 4, 18, 'M16', 100, 1.15, 40],
      [40, '/4', 1600, 150, 12, 56, 2, 4, 18, 'M16', 110, 1.3, 40],
      [50, '/4', 1600, 165, 12, 66, 3, 4, 18, 'M16', 125, 1.55, 40],
      [65, '/4', 1600, 185, 12, 82, 3, 8, 18, 'M16', 145, 1.88, 40],
      [80, '/4', 1600, 200, 14, 95, 3, 8, 18, 'M16', 160, 2.55, 45],
      [100, '/4', 1600, 235, 16, 121, 3, 8, 22, 'M20', 190, 4.3, 50],

      // ===== TYPE /6 SOCKET WELD FLANGES =====
      // Socket weld flanges typically available up to 80NB
      // T600 (PN6)
      [15, '/6', 600, 80, 10, 26, 2, 4, 11, 'M10', 55, 0.32, 30],
      [20, '/6', 600, 90, 10, 33, 2, 4, 11, 'M10', 65, 0.42, 30],
      [25, '/6', 600, 100, 10, 40, 2, 4, 11, 'M10', 75, 0.52, 30],
      [32, '/6', 600, 120, 10, 50, 2, 4, 14, 'M12', 90, 0.7, 30],
      [40, '/6', 600, 130, 10, 56, 2, 4, 14, 'M12', 100, 0.8, 30],
      [50, '/6', 600, 140, 10, 66, 3, 4, 14, 'M12', 110, 0.95, 30],
      [65, '/6', 600, 160, 10, 82, 3, 4, 14, 'M12', 130, 1.18, 30],
      [80, '/6', 600, 190, 12, 95, 3, 4, 18, 'M16', 150, 1.9, 40],
      // T1000 (PN10)
      [15, '/6', 1000, 95, 10, 26, 2, 4, 14, 'M12', 65, 0.48, 35],
      [20, '/6', 1000, 105, 10, 33, 2, 4, 14, 'M12', 75, 0.58, 35],
      [25, '/6', 1000, 115, 10, 40, 2, 4, 14, 'M12', 85, 0.7, 35],
      [32, '/6', 1000, 140, 12, 50, 2, 4, 18, 'M16', 100, 1.2, 40],
      [40, '/6', 1000, 150, 12, 56, 2, 4, 18, 'M16', 110, 1.35, 40],
      [50, '/6', 1000, 165, 12, 66, 3, 4, 18, 'M16', 125, 1.6, 40],
      [65, '/6', 1000, 185, 12, 82, 3, 8, 18, 'M16', 145, 1.92, 40],
      [80, '/6', 1000, 200, 14, 95, 3, 8, 18, 'M16', 160, 2.6, 45],
      // T1600 (PN16)
      [15, '/6', 1600, 95, 10, 26, 2, 4, 14, 'M12', 65, 0.48, 35],
      [20, '/6', 1600, 105, 10, 33, 2, 4, 14, 'M12', 75, 0.58, 35],
      [25, '/6', 1600, 115, 10, 40, 2, 4, 14, 'M12', 85, 0.7, 35],
      [32, '/6', 1600, 140, 12, 50, 2, 4, 18, 'M16', 100, 1.2, 40],
      [40, '/6', 1600, 150, 12, 56, 2, 4, 18, 'M16', 110, 1.35, 40],
      [50, '/6', 1600, 165, 12, 66, 3, 4, 18, 'M16', 125, 1.6, 40],
      [65, '/6', 1600, 185, 12, 82, 3, 8, 18, 'M16', 145, 1.92, 40],
      [80, '/6', 1600, 200, 14, 95, 3, 8, 18, 'M16', 160, 2.6, 45],

      // ===== TYPE /7 HUBBED SLIP-ON FLANGES =====
      // Hubbed slip-on flanges available in common NB sizes
      // T600 (PN6)
      [15, '/7', 600, 80, 11, 26, 2, 4, 11, 'M10', 55, 0.34, 32],
      [20, '/7', 600, 90, 11, 33, 2, 4, 11, 'M10', 65, 0.45, 32],
      [25, '/7', 600, 100, 11, 40, 2, 4, 11, 'M10', 75, 0.55, 32],
      [32, '/7', 600, 120, 11, 50, 2, 4, 14, 'M12', 90, 0.75, 32],
      [40, '/7', 600, 130, 11, 56, 2, 4, 14, 'M12', 100, 0.85, 32],
      [50, '/7', 600, 140, 11, 66, 3, 4, 14, 'M12', 110, 1.0, 32],
      [65, '/7', 600, 160, 11, 82, 3, 4, 14, 'M12', 130, 1.25, 32],
      [80, '/7', 600, 190, 13, 95, 3, 4, 18, 'M16', 150, 2.0, 42],
      [100, '/7', 600, 210, 13, 121, 3, 8, 18, 'M16', 170, 2.2, 42],
      [150, '/7', 600, 265, 13, 176, 3, 8, 18, 'M16', 225, 3.1, 42],
      [200, '/7', 600, 320, 15, 229, 3, 8, 18, 'M16', 280, 4.6, 48],
      [250, '/7', 600, 375, 17, 284, 3, 12, 18, 'M16', 335, 6.2, 52],
      [300, '/7', 600, 440, 17, 337, 4, 12, 22, 'M20', 395, 7.6, 52],
      // T1000 (PN10)
      [15, '/7', 1000, 95, 11, 26, 2, 4, 14, 'M12', 65, 0.5, 38],
      [20, '/7', 1000, 105, 11, 33, 2, 4, 14, 'M12', 75, 0.62, 38],
      [25, '/7', 1000, 115, 11, 40, 2, 4, 14, 'M12', 85, 0.74, 38],
      [32, '/7', 1000, 140, 13, 50, 2, 4, 18, 'M16', 100, 1.25, 42],
      [40, '/7', 1000, 150, 13, 56, 2, 4, 18, 'M16', 110, 1.42, 42],
      [50, '/7', 1000, 165, 13, 66, 3, 4, 18, 'M16', 125, 1.68, 42],
      [65, '/7', 1000, 185, 13, 82, 3, 8, 18, 'M16', 145, 2.0, 42],
      [80, '/7', 1000, 200, 15, 95, 3, 8, 18, 'M16', 160, 2.75, 48],
      [100, '/7', 1000, 220, 15, 121, 3, 8, 18, 'M16', 180, 3.6, 48],
      [150, '/7', 1000, 285, 17, 176, 3, 8, 22, 'M20', 240, 6.4, 52],
      [200, '/7', 1000, 340, 19, 229, 3, 12, 22, 'M20', 295, 10.7, 58],
      [250, '/7', 1000, 405, 21, 284, 3, 12, 26, 'M24', 355, 17.5, 62],
      [300, '/7', 1000, 460, 23, 337, 4, 12, 26, 'M24', 410, 26.0, 68],
      // T1600 (PN16)
      [15, '/7', 1600, 95, 11, 26, 2, 4, 14, 'M12', 65, 0.5, 38],
      [20, '/7', 1600, 105, 11, 33, 2, 4, 14, 'M12', 75, 0.62, 38],
      [25, '/7', 1600, 115, 11, 40, 2, 4, 14, 'M12', 85, 0.74, 38],
      [32, '/7', 1600, 140, 13, 50, 2, 4, 18, 'M16', 100, 1.25, 42],
      [40, '/7', 1600, 150, 13, 56, 2, 4, 18, 'M16', 110, 1.42, 42],
      [50, '/7', 1600, 165, 13, 66, 3, 4, 18, 'M16', 125, 1.68, 42],
      [65, '/7', 1600, 185, 13, 82, 3, 8, 18, 'M16', 145, 2.0, 42],
      [80, '/7', 1600, 200, 15, 95, 3, 8, 18, 'M16', 160, 2.75, 48],
      [100, '/7', 1600, 235, 17, 121, 3, 8, 22, 'M20', 190, 4.6, 52],
      [150, '/7', 1600, 300, 19, 176, 3, 8, 26, 'M24', 250, 8.2, 58],
      [200, '/7', 1600, 360, 23, 229, 3, 12, 26, 'M24', 310, 15.4, 68],
      [250, '/7', 1600, 425, 27, 284, 3, 12, 30, 'M27', 370, 24.7, 78],
      [300, '/7', 1600, 485, 31, 337, 4, 12, 30, 'M27', 430, 38.5, 88],
      // T2500 (PN25)
      [15, '/7', 2500, 95, 15, 26, 2, 4, 14, 'M12', 65, 0.68, 48],
      [20, '/7', 2500, 105, 15, 33, 2, 4, 14, 'M12', 75, 0.85, 48],
      [25, '/7', 2500, 115, 17, 40, 2, 4, 14, 'M12', 85, 1.18, 52],
      [32, '/7', 2500, 140, 17, 50, 2, 4, 18, 'M16', 100, 1.7, 52],
      [40, '/7', 2500, 150, 17, 56, 2, 4, 18, 'M16', 110, 1.95, 52],
      [50, '/7', 2500, 165, 19, 66, 3, 4, 18, 'M16', 125, 2.6, 58],
      [65, '/7', 2500, 185, 21, 82, 3, 8, 18, 'M16', 145, 3.4, 62],
      [80, '/7', 2500, 200, 21, 95, 3, 8, 18, 'M16', 160, 4.4, 62],
      [100, '/7', 2500, 250, 23, 121, 3, 8, 26, 'M24', 200, 6.8, 68],
      [150, '/7', 2500, 340, 29, 176, 4, 12, 30, 'M27', 280, 13.8, 82],
      [200, '/7', 2500, 405, 35, 229, 4, 12, 33, 'M30', 345, 26.4, 98],
      [250, '/7', 2500, 470, 39, 284, 4, 12, 36, 'M33', 410, 38.5, 108],
      [300, '/7', 2500, 535, 45, 337, 4, 16, 36, 'M33', 475, 60.5, 122],
      // T4000 (PN40)
      [15, '/7', 4000, 95, 17, 26, 2, 4, 14, 'M12', 65, 0.78, 52],
      [20, '/7', 4000, 105, 17, 33, 2, 4, 14, 'M12', 75, 0.98, 52],
      [25, '/7', 4000, 115, 19, 40, 2, 4, 14, 'M12', 85, 1.35, 58],
      [32, '/7', 4000, 140, 21, 50, 2, 4, 18, 'M16', 100, 2.0, 62],
      [40, '/7', 4000, 150, 21, 56, 2, 4, 18, 'M16', 110, 2.3, 62],
      [50, '/7', 4000, 165, 23, 66, 3, 4, 18, 'M16', 125, 3.1, 68],
      [65, '/7', 4000, 185, 27, 82, 3, 8, 18, 'M16', 145, 4.4, 78],
      [80, '/7', 4000, 200, 27, 95, 3, 8, 18, 'M16', 160, 5.7, 78],
      [100, '/7', 4000, 265, 31, 121, 3, 8, 30, 'M27', 212, 8.8, 88],
      [150, '/7', 4000, 355, 39, 176, 4, 12, 33, 'M30', 295, 18.7, 108],
      [200, '/7', 4000, 430, 47, 229, 4, 12, 36, 'M33', 365, 35.2, 128],
      [250, '/7', 4000, 505, 53, 284, 4, 12, 39, 'M36', 440, 52.8, 145],
      [300, '/7', 4000, 585, 61, 337, 4, 16, 42, 'M39', 515, 82.5, 165],
    ];

    // Insert all flange dimension data
    console.warn(`Inserting ${flangeData.length} flange dimension records...`);

    let insertedCount = 0;
    let skippedCount = 0;

    for (const flange of flangeData) {
      const [
        nominalMm,
        typeCode,
        pressure,
        D,
        b,
        d4,
        f,
        holes,
        d1,
        bolt,
        pcd,
        mass,
        _boltLength, // Reserved for future use
      ] = flange;

      const nominalId = await getNominalId(nominalMm);
      if (!nominalId) {
        console.warn(`Nominal size ${nominalMm}NB not found, skipping...`);
        skippedCount++;
        continue;
      }

      const typeId = typeIds[typeCode as keyof typeof typeIds];
      if (!typeId) {
        console.warn(`Flange type ${typeCode} not found, skipping...`);
        skippedCount++;
        continue;
      }

      const pressureClassDesignation = `${pressure}${typeCode}`;
      const pressureClassId = await getPressureClassId(
        pressureClassDesignation,
      );
      if (!pressureClassId) {
        console.warn(
          `Pressure class ${pressureClassDesignation} not found, skipping...`,
        );
        skippedCount++;
        continue;
      }

      const boltId = bolt ? await getBoltId(bolt) : null;

      // Check if this record already exists
      const existing = await queryRunner.query(`
        SELECT id FROM flange_dimensions
        WHERE "nominalOutsideDiameterId" = ${nominalId}
          AND "standardId" = ${sabs1123Id}
          AND "pressureClassId" = ${pressureClassId}
          AND "flangeTypeId" = ${typeId}
      `);

      if (existing.length > 0) {
        // Update existing record
        await queryRunner.query(`
          UPDATE flange_dimensions SET
            "D" = ${D}, "b" = ${b}, "d4" = ${d4}, "f" = ${f},
            "num_holes" = ${holes}, "d1" = ${d1},
            "boltId" = ${boltId || 'NULL'}, "pcd" = ${pcd}, "mass_kg" = ${mass}
          WHERE id = ${existing[0].id}
        `);
      } else {
        // Insert new record
        await queryRunner.query(`
          INSERT INTO flange_dimensions (
            "nominalOutsideDiameterId", "standardId", "pressureClassId", "flangeTypeId",
            "D", "b", "d4", "f", "num_holes", "d1", "boltId", "pcd", "mass_kg"
          ) VALUES (
            ${nominalId}, ${sabs1123Id}, ${pressureClassId}, ${typeId},
            ${D}, ${b}, ${d4}, ${f}, ${holes}, ${d1}, ${boltId || 'NULL'}, ${pcd}, ${mass}
          )
        `);
      }
      insertedCount++;
    }

    console.warn(
      `SABS 1123 flange data migration complete: ${insertedCount} records added/updated, ${skippedCount} skipped`,
    );
  }

  public async down(queryRunner: QueryRunner): Promise<void> {
    // Get SABS 1123 standard ID
    const sabs1123Result = await queryRunner.query(
      `SELECT id FROM flange_standards WHERE code = 'SABS 1123'`,
    );
    if (sabs1123Result.length === 0) return;
    const sabs1123Id = sabs1123Result[0].id;

    // Remove flange dimensions with flange types
    await queryRunner.query(`
      DELETE FROM flange_dimensions
      WHERE "standardId" = ${sabs1123Id} AND "flangeTypeId" IS NOT NULL
    `);

    // Remove SABS 1123 pressure classes with type suffixes
    await queryRunner.query(`
      DELETE FROM flange_pressure_classes
      WHERE "standardId" = ${sabs1123Id}
        AND designation ~ '^[0-9]+/[1-8]$'
    `);

    // Drop flangeTypeId column if it exists
    const columnExists = await queryRunner.query(`
      SELECT column_name FROM information_schema.columns
      WHERE table_name = 'flange_dimensions' AND column_name = 'flangeTypeId'
    `);
    if (columnExists.length > 0) {
      await queryRunner.query(`
        ALTER TABLE flange_dimensions DROP COLUMN "flangeTypeId"
      `);
    }

    console.warn('SABS 1123 comprehensive flange data removed');
  }
}
