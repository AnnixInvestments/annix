import { MigrationInterface, QueryRunner } from 'typeorm';

export class AddComprehensiveAsmeB165FlangeData1770300000000
  implements MigrationInterface
{
  name = 'AddComprehensiveAsmeB165FlangeData1770300000000';

  public async up(queryRunner: QueryRunner): Promise<void> {
    console.warn('Adding comprehensive ASME B16.5 flange data...');

    const asmeB165Id = 4;

    const getTypeId = async (code: string) => {
      const result = await queryRunner.query(
        `SELECT id FROM flange_types WHERE code = '${code}'`
      );
      return result[0]?.id;
    };

    const typeIds = {
      '/2': await getTypeId('/2'),
      '/3': await getTypeId('/3'),
      '/8': await getTypeId('/8'),
    };

    const pressureClasses = [150, 300, 600, 900, 1500, 2500];
    const flangeTypeCodes = ['/2', '/3', '/8'];

    for (const pressure of pressureClasses) {
      for (const typeCode of flangeTypeCodes) {
        const designation = `${pressure}${typeCode}`;
        const existing = await queryRunner.query(`
          SELECT id FROM flange_pressure_classes
          WHERE designation = '${designation}' AND "standardId" = ${asmeB165Id}
        `);
        if (existing.length === 0) {
          await queryRunner.query(`
            INSERT INTO flange_pressure_classes (designation, "standardId")
            VALUES ('${designation}', ${asmeB165Id})
          `);
        }
      }
    }

    const getNominalId = async (nominalMm: number) => {
      const result = await queryRunner.query(`
        SELECT id FROM nominal_outside_diameters
        WHERE nominal_diameter_mm = ${nominalMm}
        LIMIT 1
      `);
      return result[0]?.id;
    };

    const getPressureClassId = async (designation: string) => {
      const result = await queryRunner.query(`
        SELECT id FROM flange_pressure_classes
        WHERE designation = '${designation}' AND "standardId" = ${asmeB165Id}
      `);
      return result[0]?.id;
    };

    const getBoltId = async (designation: string) => {
      if (!designation) return null;
      const result = await queryRunner.query(
        `SELECT id FROM bolts WHERE designation = '${designation}'`
      );
      return result[0]?.id;
    };

    // ASME B16.5 flange dimension data
    // Format: [NB, type, class, D, b, d4, f, holes, d1, bolt, pcd, mass, boltLength]
    // ASME B16.5 classes: 150, 300, 600, 900, 1500, 2500
    // Types: /2 (Weld Neck), /3 (Slip-On), /8 (Blind)
    // Dimensions based on ASME B16.5-2020 standard
    // Note: NB sizes are in mm but correspond to NPS (Nominal Pipe Size)

    const flangeData: Array<[number, string, number, number, number, number, number, number, number, string | null, number, number, number]> = [
      // ===== 15NB (1/2" NPS, 21.3 OD) =====
      // Class 150
      [15, '/2', 150, 89, 14, 22, 2, 4, 16, '1/2"', 60, 0.45, 50],
      [15, '/3', 150, 89, 11, 22, 2, 4, 16, '1/2"', 60, 0.36, 45],
      [15, '/8', 150, 89, 11, 0, 2, 4, 16, '1/2"', 60, 0.45, 45],
      // Class 300
      [15, '/2', 300, 95, 22, 22, 2, 4, 16, '1/2"', 67, 0.91, 55],
      [15, '/3', 300, 95, 14, 22, 2, 4, 16, '1/2"', 67, 0.54, 50],
      [15, '/8', 300, 95, 14, 0, 2, 4, 16, '1/2"', 67, 0.68, 50],
      // Class 600
      [15, '/2', 600, 95, 22, 22, 2, 4, 16, '1/2"', 67, 0.91, 55],
      [15, '/3', 600, 95, 14, 22, 2, 4, 16, '1/2"', 67, 0.54, 50],
      [15, '/8', 600, 95, 14, 0, 2, 4, 16, '1/2"', 67, 0.68, 50],
      // Class 900
      [15, '/2', 900, 121, 32, 22, 2, 4, 22, '3/4"', 83, 1.91, 75],
      [15, '/8', 900, 121, 22, 0, 2, 4, 22, '3/4"', 83, 1.59, 65],
      // Class 1500
      [15, '/2', 1500, 121, 32, 22, 2, 4, 22, '3/4"', 83, 1.91, 75],
      [15, '/8', 1500, 121, 22, 0, 2, 4, 22, '3/4"', 83, 1.59, 65],
      // Class 2500
      [15, '/2', 2500, 133, 44, 22, 2, 4, 22, '3/4"', 89, 3.63, 95],
      [15, '/8', 2500, 133, 30, 0, 2, 4, 22, '3/4"', 89, 2.95, 80],

      // ===== 20NB (3/4" NPS, 26.7 OD) =====
      // Class 150
      [20, '/2', 150, 98, 16, 27, 2, 4, 16, '1/2"', 70, 0.59, 50],
      [20, '/3', 150, 98, 13, 27, 2, 4, 16, '1/2"', 70, 0.45, 45],
      [20, '/8', 150, 98, 13, 0, 2, 4, 16, '1/2"', 70, 0.59, 45],
      // Class 300
      [20, '/2', 300, 117, 25, 27, 2, 4, 19, '5/8"', 83, 1.50, 60],
      [20, '/3', 300, 117, 16, 27, 2, 4, 19, '5/8"', 83, 0.91, 50],
      [20, '/8', 300, 117, 16, 0, 2, 4, 19, '5/8"', 83, 1.09, 50],
      // Class 600
      [20, '/2', 600, 117, 25, 27, 2, 4, 19, '5/8"', 83, 1.50, 60],
      [20, '/3', 600, 117, 16, 27, 2, 4, 19, '5/8"', 83, 0.91, 50],
      [20, '/8', 600, 117, 16, 0, 2, 4, 19, '5/8"', 83, 1.09, 50],
      // Class 900
      [20, '/2', 900, 130, 35, 27, 2, 4, 22, '3/4"', 89, 2.50, 80],
      [20, '/8', 900, 130, 25, 0, 2, 4, 22, '3/4"', 89, 2.09, 70],
      // Class 1500
      [20, '/2', 1500, 130, 35, 27, 2, 4, 22, '3/4"', 89, 2.50, 80],
      [20, '/8', 1500, 130, 25, 0, 2, 4, 22, '3/4"', 89, 2.09, 70],
      // Class 2500
      [20, '/2', 2500, 140, 51, 27, 2, 4, 22, '3/4"', 95, 4.54, 105],
      [20, '/8', 2500, 140, 35, 0, 2, 4, 22, '3/4"', 95, 3.63, 85],

      // ===== 25NB (1" NPS, 33.4 OD) =====
      // Class 150
      [25, '/2', 150, 108, 17, 34, 2, 4, 16, '1/2"', 79, 0.77, 55],
      [25, '/3', 150, 108, 14, 34, 2, 4, 16, '1/2"', 79, 0.59, 50],
      [25, '/8', 150, 108, 14, 0, 2, 4, 16, '1/2"', 79, 0.77, 50],
      // Class 300
      [25, '/2', 300, 124, 27, 34, 2, 4, 19, '5/8"', 89, 1.77, 65],
      [25, '/3', 300, 124, 17, 34, 2, 4, 19, '5/8"', 89, 1.04, 55],
      [25, '/8', 300, 124, 17, 0, 2, 4, 19, '5/8"', 89, 1.27, 55],
      // Class 600
      [25, '/2', 600, 124, 27, 34, 2, 4, 19, '5/8"', 89, 1.77, 65],
      [25, '/3', 600, 124, 17, 34, 2, 4, 19, '5/8"', 89, 1.04, 55],
      [25, '/8', 600, 124, 17, 0, 2, 4, 19, '5/8"', 89, 1.27, 55],
      // Class 900
      [25, '/2', 900, 149, 38, 34, 2, 4, 26, '7/8"', 102, 3.63, 90],
      [25, '/8', 900, 149, 29, 0, 2, 4, 26, '7/8"', 102, 3.04, 80],
      // Class 1500
      [25, '/2', 1500, 149, 38, 34, 2, 4, 26, '7/8"', 102, 3.63, 90],
      [25, '/8', 1500, 149, 29, 0, 2, 4, 26, '7/8"', 102, 3.04, 80],
      // Class 2500
      [25, '/2', 2500, 159, 57, 34, 2, 4, 26, '7/8"', 108, 6.35, 115],
      [25, '/8', 2500, 159, 41, 0, 2, 4, 26, '7/8"', 108, 5.00, 95],

      // ===== 32NB (1-1/4" NPS, 42.2 OD) =====
      // Class 150
      [32, '/2', 150, 117, 19, 43, 2, 4, 16, '1/2"', 89, 1.00, 55],
      [32, '/3', 150, 117, 16, 43, 2, 4, 16, '1/2"', 89, 0.77, 50],
      [32, '/8', 150, 117, 16, 0, 2, 4, 16, '1/2"', 89, 1.04, 50],
      // Class 300
      [32, '/2', 300, 133, 29, 43, 2, 4, 19, '5/8"', 98, 2.18, 70],
      [32, '/3', 300, 133, 19, 43, 2, 4, 19, '5/8"', 98, 1.27, 55],
      [32, '/8', 300, 133, 19, 0, 2, 4, 19, '5/8"', 98, 1.59, 55],
      // Class 600
      [32, '/2', 600, 133, 29, 43, 2, 4, 19, '5/8"', 98, 2.18, 70],
      [32, '/3', 600, 133, 19, 43, 2, 4, 19, '5/8"', 98, 1.27, 55],
      [32, '/8', 600, 133, 19, 0, 2, 4, 19, '5/8"', 98, 1.59, 55],
      // Class 900
      [32, '/2', 900, 159, 41, 43, 2, 4, 26, '7/8"', 114, 4.54, 95],
      [32, '/8', 900, 159, 32, 0, 2, 4, 26, '7/8"', 114, 3.86, 85],
      // Class 1500
      [32, '/2', 1500, 159, 41, 43, 2, 4, 26, '7/8"', 114, 4.54, 95],
      [32, '/8', 1500, 159, 32, 0, 2, 4, 26, '7/8"', 114, 3.86, 85],
      // Class 2500
      [32, '/2', 2500, 184, 67, 43, 2, 4, 29, '1"', 130, 10.43, 130],
      [32, '/8', 2500, 184, 48, 0, 2, 4, 29, '1"', 130, 8.16, 110],

      // ===== 40NB (1-1/2" NPS, 48.3 OD) =====
      // Class 150
      [40, '/2', 150, 127, 21, 49, 2, 4, 16, '1/2"', 98, 1.27, 60],
      [40, '/3', 150, 127, 17, 49, 2, 4, 16, '1/2"', 98, 0.95, 55],
      [40, '/8', 150, 127, 17, 0, 2, 4, 16, '1/2"', 98, 1.32, 55],
      // Class 300
      [40, '/2', 300, 156, 32, 49, 2, 4, 22, '3/4"', 114, 3.40, 80],
      [40, '/3', 300, 156, 21, 49, 2, 4, 22, '3/4"', 114, 1.91, 60],
      [40, '/8', 300, 156, 21, 0, 2, 4, 22, '3/4"', 114, 2.45, 60],
      // Class 600
      [40, '/2', 600, 156, 35, 49, 2, 4, 22, '3/4"', 114, 3.86, 85],
      [40, '/3', 600, 156, 22, 49, 2, 4, 22, '3/4"', 114, 2.09, 65],
      [40, '/8', 600, 156, 25, 0, 2, 4, 22, '3/4"', 114, 2.77, 70],
      // Class 900
      [40, '/2', 900, 178, 48, 49, 2, 4, 29, '1"', 124, 6.80, 110],
      [40, '/8', 900, 178, 38, 0, 2, 4, 29, '1"', 124, 5.67, 95],
      // Class 1500
      [40, '/2', 1500, 178, 48, 49, 2, 4, 29, '1"', 124, 6.80, 110],
      [40, '/8', 1500, 178, 38, 0, 2, 4, 29, '1"', 124, 5.67, 95],
      // Class 2500
      [40, '/2', 2500, 203, 79, 49, 2, 4, 32, '1-1/8"', 146, 14.51, 150],
      [40, '/8', 2500, 203, 57, 0, 2, 4, 32, '1-1/8"', 146, 11.34, 120],

      // ===== 50NB (2" NPS, 60.3 OD) =====
      // Class 150
      [50, '/2', 150, 152, 24, 62, 2, 4, 19, '5/8"', 121, 2.18, 65],
      [50, '/3', 150, 152, 19, 62, 2, 4, 19, '5/8"', 121, 1.59, 55],
      [50, '/8', 150, 152, 19, 0, 2, 4, 19, '5/8"', 121, 2.27, 55],
      // Class 300
      [50, '/2', 300, 165, 38, 62, 2, 8, 19, '5/8"', 127, 4.54, 85],
      [50, '/3', 300, 165, 24, 62, 2, 8, 19, '5/8"', 127, 2.54, 65],
      [50, '/8', 300, 165, 27, 0, 2, 8, 19, '5/8"', 127, 3.18, 70],
      // Class 600
      [50, '/2', 600, 165, 41, 62, 2, 8, 19, '5/8"', 127, 5.00, 90],
      [50, '/3', 600, 165, 25, 62, 2, 8, 19, '5/8"', 127, 2.72, 65],
      [50, '/8', 600, 165, 29, 0, 2, 8, 19, '5/8"', 127, 3.54, 75],
      // Class 900
      [50, '/2', 900, 216, 57, 62, 2, 8, 26, '7/8"', 165, 11.79, 120],
      [50, '/8', 900, 216, 44, 0, 2, 8, 26, '7/8"', 165, 10.43, 105],
      // Class 1500
      [50, '/2', 1500, 216, 60, 62, 2, 8, 26, '7/8"', 165, 12.47, 125],
      [50, '/8', 1500, 216, 48, 0, 2, 8, 26, '7/8"', 165, 11.11, 110],
      // Class 2500
      [50, '/2', 2500, 267, 105, 62, 2, 8, 35, '1-1/4"', 190, 34.93, 190],
      [50, '/8', 2500, 267, 76, 0, 2, 8, 35, '1-1/4"', 190, 28.58, 155],

      // ===== 65NB (2-1/2" NPS, 73.0 OD) =====
      // Class 150
      [65, '/2', 150, 178, 27, 75, 2, 4, 19, '5/8"', 140, 3.40, 70],
      [65, '/3', 150, 178, 22, 75, 2, 4, 19, '5/8"', 140, 2.45, 60],
      [65, '/8', 150, 178, 22, 0, 2, 4, 19, '5/8"', 140, 3.54, 60],
      // Class 300
      [65, '/2', 300, 190, 43, 75, 2, 8, 22, '3/4"', 149, 6.35, 95],
      [65, '/3', 300, 190, 29, 75, 2, 8, 22, '3/4"', 149, 3.63, 75],
      [65, '/8', 300, 190, 30, 0, 2, 8, 22, '3/4"', 149, 4.31, 80],
      // Class 600
      [65, '/2', 600, 190, 48, 75, 2, 8, 22, '3/4"', 149, 7.26, 100],
      [65, '/3', 600, 190, 30, 75, 2, 8, 22, '3/4"', 149, 3.86, 75],
      [65, '/8', 600, 190, 33, 0, 2, 8, 22, '3/4"', 149, 4.76, 85],
      // Class 900
      [65, '/2', 900, 244, 64, 75, 2, 8, 32, '1-1/8"', 190, 17.24, 135],
      [65, '/8', 900, 244, 51, 0, 2, 8, 32, '1-1/8"', 190, 15.42, 120],
      // Class 1500
      [65, '/2', 1500, 244, 70, 75, 2, 8, 32, '1-1/8"', 190, 18.60, 145],
      [65, '/8', 1500, 244, 57, 0, 2, 8, 32, '1-1/8"', 190, 16.78, 130],
      // Class 2500
      [65, '/2', 2500, 292, 117, 75, 2, 8, 35, '1-1/4"', 216, 42.64, 210],
      [65, '/8', 2500, 292, 89, 0, 2, 8, 35, '1-1/4"', 216, 36.29, 175],

      // ===== 80NB (3" NPS, 88.9 OD) =====
      // Class 150
      [80, '/2', 150, 190, 29, 90, 2, 4, 19, '5/8"', 152, 4.08, 75],
      [80, '/3', 150, 190, 24, 90, 2, 4, 19, '5/8"', 152, 2.95, 65],
      [80, '/8', 150, 190, 24, 0, 2, 4, 19, '5/8"', 152, 4.31, 65],
      // Class 300
      [80, '/2', 300, 210, 48, 90, 2, 8, 22, '3/4"', 168, 8.16, 105],
      [80, '/3', 300, 210, 32, 90, 2, 8, 22, '3/4"', 168, 4.54, 80],
      [80, '/8', 300, 210, 33, 0, 2, 8, 22, '3/4"', 168, 5.44, 85],
      // Class 600
      [80, '/2', 600, 210, 54, 90, 2, 8, 22, '3/4"', 168, 9.30, 115],
      [80, '/3', 600, 210, 33, 90, 2, 8, 22, '3/4"', 168, 4.76, 85],
      [80, '/8', 600, 210, 38, 0, 2, 8, 22, '3/4"', 168, 6.12, 95],
      // Class 900
      [80, '/2', 900, 241, 73, 90, 2, 8, 26, '7/8"', 190, 17.24, 145],
      [80, '/8', 900, 241, 57, 0, 2, 8, 26, '7/8"', 190, 15.19, 125],
      // Class 1500
      [80, '/2', 1500, 264, 83, 90, 2, 8, 32, '1-1/8"', 203, 24.95, 165],
      [80, '/8', 1500, 264, 67, 0, 2, 8, 32, '1-1/8"', 203, 22.22, 145],
      // Class 2500
      [80, '/2', 2500, 318, 130, 90, 2, 8, 35, '1-1/4"', 241, 56.70, 230],
      [80, '/8', 2500, 318, 102, 0, 2, 8, 35, '1-1/4"', 241, 48.08, 195],

      // ===== 100NB (4" NPS, 114.3 OD) =====
      // Class 150
      [100, '/2', 150, 229, 32, 116, 2, 8, 19, '5/8"', 190, 6.12, 80],
      [100, '/3', 150, 229, 24, 116, 2, 8, 19, '5/8"', 190, 4.08, 65],
      [100, '/8', 150, 229, 24, 0, 2, 8, 19, '5/8"', 190, 6.35, 65],
      // Class 300
      [100, '/2', 300, 254, 54, 116, 2, 8, 22, '3/4"', 200, 12.25, 115],
      [100, '/3', 300, 254, 38, 116, 2, 8, 22, '3/4"', 200, 7.26, 90],
      [100, '/8', 300, 254, 38, 0, 2, 8, 22, '3/4"', 200, 9.07, 90],
      // Class 600
      [100, '/2', 600, 273, 64, 116, 2, 8, 26, '7/8"', 216, 17.69, 130],
      [100, '/3', 600, 273, 43, 116, 2, 8, 26, '7/8"', 216, 9.98, 100],
      [100, '/8', 600, 273, 48, 0, 2, 8, 26, '7/8"', 216, 12.47, 110],
      // Class 900
      [100, '/2', 900, 292, 83, 116, 2, 8, 32, '1-1/8"', 235, 27.22, 165],
      [100, '/8', 900, 292, 64, 0, 2, 8, 32, '1-1/8"', 235, 23.59, 140],
      // Class 1500
      [100, '/2', 1500, 311, 102, 116, 2, 8, 35, '1-1/4"', 248, 38.56, 195],
      [100, '/8', 1500, 311, 79, 0, 2, 8, 35, '1-1/4"', 248, 33.11, 165],
      // Class 2500
      [100, '/2', 2500, 368, 149, 116, 2, 8, 42, '1-1/2"', 286, 77.11, 270],
      [100, '/8', 2500, 368, 117, 0, 2, 8, 42, '1-1/2"', 286, 65.77, 225],

      // ===== 125NB (5" NPS, 141.3 OD) =====
      // Class 150
      [125, '/2', 150, 254, 35, 144, 2, 8, 22, '3/4"', 216, 8.16, 85],
      [125, '/3', 150, 254, 25, 144, 2, 8, 22, '3/4"', 216, 5.22, 70],
      [125, '/8', 150, 254, 25, 0, 2, 8, 22, '3/4"', 216, 8.39, 70],
      // Class 300
      [125, '/2', 300, 279, 60, 144, 2, 8, 22, '3/4"', 235, 16.10, 125],
      [125, '/3', 300, 279, 41, 144, 2, 8, 22, '3/4"', 235, 9.30, 95],
      [125, '/8', 300, 279, 44, 0, 2, 8, 22, '3/4"', 235, 12.02, 100],
      // Class 600
      [125, '/2', 600, 330, 73, 144, 2, 8, 29, '1"', 267, 29.03, 150],
      [125, '/3', 600, 330, 51, 144, 2, 8, 29, '1"', 267, 17.24, 115],
      [125, '/8', 600, 330, 57, 0, 2, 8, 29, '1"', 267, 21.77, 125],
      // Class 900
      [125, '/2', 900, 349, 95, 144, 2, 8, 35, '1-1/4"', 279, 43.54, 185],
      [125, '/8', 900, 349, 73, 0, 2, 8, 35, '1-1/4"', 279, 37.65, 155],
      // Class 1500
      [125, '/2', 1500, 375, 117, 144, 2, 8, 38, '1-3/8"', 298, 58.06, 220],
      [125, '/8', 1500, 375, 92, 0, 2, 8, 38, '1-3/8"', 298, 50.80, 190],

      // ===== 150NB (6" NPS, 168.3 OD) =====
      // Class 150
      [150, '/2', 150, 279, 37, 170, 2, 8, 22, '3/4"', 241, 10.43, 90],
      [150, '/3', 150, 279, 27, 170, 2, 8, 22, '3/4"', 241, 6.58, 75],
      [150, '/8', 150, 279, 27, 0, 2, 8, 22, '3/4"', 241, 10.89, 75],
      // Class 300
      [150, '/2', 300, 318, 68, 170, 2, 12, 22, '3/4"', 270, 23.13, 140],
      [150, '/3', 300, 318, 46, 170, 2, 12, 22, '3/4"', 270, 12.93, 105],
      [150, '/8', 300, 318, 51, 0, 2, 12, 22, '3/4"', 270, 17.01, 115],
      // Class 600
      [150, '/2', 600, 356, 86, 170, 2, 12, 26, '7/8"', 302, 36.29, 170],
      [150, '/3', 600, 356, 57, 170, 2, 12, 26, '7/8"', 302, 20.41, 130],
      [150, '/8', 600, 356, 64, 0, 2, 12, 26, '7/8"', 302, 26.31, 145],
      // Class 900
      [150, '/2', 900, 381, 108, 170, 2, 12, 29, '1"', 318, 54.43, 205],
      [150, '/8', 900, 381, 83, 0, 2, 12, 29, '1"', 318, 46.72, 175],
      // Class 1500
      [150, '/2', 1500, 394, 127, 170, 2, 12, 32, '1-1/8"', 330, 68.95, 240],
      [150, '/8', 1500, 394, 102, 0, 2, 12, 32, '1-1/8"', 330, 59.87, 205],
      // Class 2500
      [150, '/2', 2500, 483, 200, 170, 2, 12, 42, '1-1/2"', 387, 158.76, 360],
      [150, '/8', 2500, 483, 159, 0, 2, 12, 42, '1-1/2"', 387, 136.08, 305],

      // ===== 200NB (8" NPS, 219.1 OD) =====
      // Class 150
      [200, '/2', 150, 343, 43, 222, 2, 8, 22, '3/4"', 298, 17.24, 100],
      [200, '/3', 150, 343, 32, 222, 2, 8, 22, '3/4"', 298, 10.89, 85],
      [200, '/8', 150, 343, 32, 0, 2, 8, 22, '3/4"', 298, 18.14, 85],
      // Class 300
      [200, '/2', 300, 381, 75, 222, 2, 12, 26, '7/8"', 330, 38.10, 155],
      [200, '/3', 300, 381, 51, 222, 2, 12, 26, '7/8"', 330, 21.32, 115],
      [200, '/8', 300, 381, 57, 0, 2, 12, 26, '7/8"', 330, 27.67, 130],
      // Class 600
      [200, '/2', 600, 419, 102, 222, 2, 12, 32, '1-1/8"', 362, 59.87, 195],
      [200, '/3', 600, 419, 67, 222, 2, 12, 32, '1-1/8"', 362, 32.66, 145],
      [200, '/8', 600, 419, 76, 0, 2, 12, 32, '1-1/8"', 362, 42.18, 165],
      // Class 900
      [200, '/2', 900, 470, 127, 222, 2, 12, 38, '1-3/8"', 400, 95.25, 240],
      [200, '/8', 900, 470, 102, 0, 2, 12, 38, '1-3/8"', 400, 82.10, 205],
      // Class 1500
      [200, '/2', 1500, 508, 159, 222, 2, 12, 42, '1-1/2"', 432, 136.08, 295],
      [200, '/8', 1500, 508, 127, 0, 2, 12, 42, '1-1/2"', 432, 117.93, 250],

      // ===== 250NB (10" NPS, 273.0 OD) =====
      // Class 150
      [250, '/2', 150, 406, 48, 276, 2, 12, 26, '7/8"', 362, 26.76, 110],
      [250, '/3', 150, 406, 35, 276, 2, 12, 26, '7/8"', 362, 16.78, 90],
      [250, '/8', 150, 406, 35, 0, 2, 12, 26, '7/8"', 362, 28.12, 90],
      // Class 300
      [250, '/2', 300, 444, 86, 276, 2, 16, 29, '1"', 387, 54.43, 170],
      [250, '/3', 300, 444, 57, 276, 2, 16, 29, '1"', 387, 29.48, 125],
      [250, '/8', 300, 444, 64, 0, 2, 16, 29, '1"', 387, 38.56, 140],
      // Class 600
      [250, '/2', 600, 508, 117, 276, 2, 16, 35, '1-1/4"', 432, 95.25, 225],
      [250, '/3', 600, 508, 79, 276, 2, 16, 35, '1-1/4"', 432, 52.16, 170],
      [250, '/8', 600, 508, 89, 0, 2, 16, 35, '1-1/4"', 432, 66.68, 190],
      // Class 900
      [250, '/2', 900, 546, 146, 276, 2, 16, 38, '1-3/8"', 470, 131.54, 275],
      [250, '/8', 900, 546, 117, 0, 2, 16, 38, '1-3/8"', 470, 113.40, 235],
      // Class 1500
      [250, '/2', 1500, 610, 184, 276, 2, 16, 45, '1-5/8"', 521, 199.58, 340],
      [250, '/8', 1500, 610, 149, 0, 2, 16, 45, '1-5/8"', 521, 174.18, 290],

      // ===== 300NB (12" NPS, 323.8 OD) =====
      // Class 150
      [300, '/2', 150, 483, 51, 327, 2, 12, 26, '7/8"', 432, 38.56, 115],
      [300, '/3', 150, 483, 37, 327, 2, 12, 26, '7/8"', 432, 23.13, 95],
      [300, '/8', 150, 483, 37, 0, 2, 12, 26, '7/8"', 432, 41.28, 95],
      // Class 300
      [300, '/2', 300, 521, 92, 327, 2, 16, 32, '1-1/8"', 457, 72.57, 180],
      [300, '/3', 300, 521, 62, 327, 2, 16, 32, '1-1/8"', 457, 38.10, 135],
      [300, '/8', 300, 521, 70, 0, 2, 16, 32, '1-1/8"', 457, 49.90, 150],
      // Class 600
      [300, '/2', 600, 559, 130, 327, 2, 20, 35, '1-1/4"', 489, 117.93, 245],
      [300, '/3', 600, 559, 86, 327, 2, 20, 35, '1-1/4"', 489, 63.50, 180],
      [300, '/8', 600, 559, 98, 0, 2, 20, 35, '1-1/4"', 489, 82.10, 200],
      // Class 900
      [300, '/2', 900, 610, 159, 327, 2, 20, 38, '1-3/8"', 533, 167.83, 295],
      [300, '/8', 900, 610, 127, 0, 2, 20, 38, '1-3/8"', 533, 144.24, 250],
      // Class 1500
      [300, '/2', 1500, 673, 203, 327, 2, 20, 48, '1-3/4"', 584, 253.11, 370],
      [300, '/8', 1500, 673, 165, 0, 2, 20, 48, '1-3/4"', 584, 221.36, 315],

      // ===== 350NB (14" NPS, 355.6 OD) =====
      // Class 150
      [350, '/2', 150, 533, 54, 359, 2, 12, 29, '1"', 476, 50.80, 120],
      [350, '/3', 150, 533, 40, 359, 2, 12, 29, '1"', 476, 29.48, 100],
      [350, '/8', 150, 533, 40, 0, 2, 12, 29, '1"', 476, 54.43, 100],
      // Class 300
      [350, '/2', 300, 584, 102, 359, 2, 20, 32, '1-1/8"', 514, 99.79, 195],
      [350, '/3', 300, 584, 67, 359, 2, 20, 32, '1-1/8"', 514, 51.26, 145],
      [350, '/8', 300, 584, 76, 0, 2, 20, 32, '1-1/8"', 514, 68.04, 165],
      // Class 600
      [350, '/2', 600, 603, 140, 359, 2, 20, 38, '1-3/8"', 527, 144.24, 265],
      [350, '/3', 600, 603, 92, 359, 2, 20, 38, '1-3/8"', 527, 77.11, 195],
      [350, '/8', 600, 603, 105, 0, 2, 20, 38, '1-3/8"', 527, 100.24, 220],
      // Class 900
      [350, '/2', 900, 641, 175, 359, 2, 20, 42, '1-1/2"', 559, 199.58, 325],
      [350, '/8', 900, 641, 140, 0, 2, 20, 42, '1-1/2"', 559, 171.46, 275],

      // ===== 400NB (16" NPS, 406.4 OD) =====
      // Class 150
      [400, '/2', 150, 597, 57, 410, 2, 16, 29, '1"', 540, 68.04, 125],
      [400, '/3', 150, 597, 43, 410, 2, 16, 29, '1"', 540, 38.56, 105],
      [400, '/8', 150, 597, 43, 0, 2, 16, 29, '1"', 540, 72.57, 105],
      // Class 300
      [400, '/2', 300, 648, 111, 410, 2, 20, 35, '1-1/4"', 578, 127.01, 210],
      [400, '/3', 300, 648, 73, 410, 2, 20, 35, '1-1/4"', 578, 65.77, 155],
      [400, '/8', 300, 648, 83, 0, 2, 20, 35, '1-1/4"', 578, 86.18, 175],
      // Class 600
      [400, '/2', 600, 686, 152, 410, 2, 20, 42, '1-1/2"', 603, 199.58, 290],
      [400, '/3', 600, 686, 102, 410, 2, 20, 42, '1-1/2"', 603, 108.86, 215],
      [400, '/8', 600, 686, 117, 0, 2, 20, 42, '1-1/2"', 603, 140.61, 245],
      // Class 900
      [400, '/2', 900, 705, 187, 410, 2, 20, 45, '1-5/8"', 616, 253.11, 345],
      [400, '/8', 900, 705, 152, 0, 2, 20, 45, '1-5/8"', 616, 217.72, 295],

      // ===== 450NB (18" NPS, 457.2 OD) =====
      // Class 150
      [450, '/2', 150, 635, 60, 462, 2, 16, 32, '1-1/8"', 578, 77.11, 130],
      [450, '/3', 150, 635, 45, 462, 2, 16, 32, '1-1/8"', 578, 43.09, 110],
      [450, '/8', 150, 635, 45, 0, 2, 16, 32, '1-1/8"', 578, 82.10, 110],
      // Class 300
      [450, '/2', 300, 711, 117, 462, 2, 24, 35, '1-1/4"', 635, 158.76, 220],
      [450, '/3', 300, 711, 79, 462, 2, 24, 35, '1-1/4"', 635, 82.10, 165],
      [450, '/8', 300, 711, 89, 0, 2, 24, 35, '1-1/4"', 635, 108.86, 185],
      // Class 600
      [450, '/2', 600, 743, 165, 462, 2, 20, 48, '1-3/4"', 654, 253.11, 310],
      [450, '/3', 600, 743, 111, 462, 2, 20, 48, '1-3/4"', 654, 140.61, 230],
      [450, '/8', 600, 743, 127, 0, 2, 20, 48, '1-3/4"', 654, 181.44, 260],
      // Class 900
      [450, '/2', 900, 787, 203, 462, 2, 20, 52, '1-7/8"', 686, 326.59, 375],
      [450, '/8', 900, 787, 165, 0, 2, 20, 52, '1-7/8"', 686, 281.23, 320],

      // ===== 500NB (20" NPS, 508.0 OD) =====
      // Class 150
      [500, '/2', 150, 699, 62, 513, 2, 20, 32, '1-1/8"', 635, 99.79, 135],
      [500, '/3', 150, 699, 48, 513, 2, 20, 32, '1-1/8"', 635, 56.24, 115],
      [500, '/8', 150, 699, 48, 0, 2, 20, 32, '1-1/8"', 635, 108.86, 115],
      // Class 300
      [500, '/2', 300, 775, 127, 513, 2, 24, 38, '1-3/8"', 699, 199.58, 240],
      [500, '/3', 300, 775, 86, 513, 2, 24, 38, '1-3/8"', 699, 104.33, 180],
      [500, '/8', 300, 775, 98, 0, 2, 24, 38, '1-3/8"', 699, 140.61, 200],
      // Class 600
      [500, '/2', 600, 813, 178, 513, 2, 24, 48, '1-3/4"', 724, 317.51, 335],
      [500, '/3', 600, 813, 121, 513, 2, 24, 48, '1-3/4"', 724, 181.44, 250],
      [500, '/8', 600, 813, 140, 0, 2, 24, 48, '1-3/4"', 724, 235.87, 285],
      // Class 900
      [500, '/2', 900, 857, 216, 513, 2, 20, 56, '2"', 762, 408.23, 395],
      [500, '/8', 900, 857, 178, 0, 2, 20, 56, '2"', 762, 353.80, 340],

      // ===== 600NB (24" NPS, 609.6 OD) =====
      // Class 150
      [600, '/2', 150, 813, 68, 616, 2, 20, 35, '1-1/4"', 749, 140.61, 145],
      [600, '/3', 150, 813, 51, 616, 2, 20, 35, '1-1/4"', 749, 77.11, 120],
      [600, '/8', 150, 813, 51, 0, 2, 20, 35, '1-1/4"', 749, 149.69, 120],
      // Class 300
      [600, '/2', 300, 914, 140, 616, 2, 24, 42, '1-1/2"', 838, 289.83, 265],
      [600, '/3', 300, 914, 95, 616, 2, 24, 42, '1-1/2"', 838, 154.22, 195],
      [600, '/8', 300, 914, 108, 0, 2, 24, 42, '1-1/2"', 838, 208.65, 220],
      // Class 600
      [600, '/2', 600, 940, 203, 616, 2, 24, 52, '1-7/8"', 851, 444.52, 380],
      [600, '/3', 600, 940, 137, 616, 2, 24, 52, '1-7/8"', 851, 253.11, 280],
      [600, '/8', 600, 940, 159, 0, 2, 24, 52, '1-7/8"', 851, 330.22, 320],
      // Class 900
      [600, '/2', 900, 1041, 254, 616, 2, 24, 64, '2-1/4"', 940, 680.39, 470],
      [600, '/8', 900, 1041, 210, 0, 2, 24, 64, '2-1/4"', 940, 589.67, 405],
    ];

    console.warn(`Inserting ${flangeData.length} ASME B16.5 flange dimension records...`);

    let insertedCount = 0;
    let skippedCount = 0;

    for (const flange of flangeData) {
      const [
        nominalMm,
        typeCode,
        classNum,
        D,
        b,
        d4,
        f,
        holes,
        d1,
        bolt,
        pcd,
        mass,
        _boltLength,
      ] = flange;

      const nominalId = await getNominalId(nominalMm);
      if (!nominalId) {
        console.warn(`Nominal size ${nominalMm}NB not found, skipping...`);
        skippedCount++;
        continue;
      }

      const typeId = typeIds[typeCode as keyof typeof typeIds];
      if (!typeId) {
        console.warn(`Flange type ${typeCode} not found, skipping...`);
        skippedCount++;
        continue;
      }

      const pressureClassDesignation = `${classNum}${typeCode}`;
      const pressureClassId = await getPressureClassId(pressureClassDesignation);
      if (!pressureClassId) {
        console.warn(`Pressure class ${pressureClassDesignation} not found, skipping...`);
        skippedCount++;
        continue;
      }

      const boltId = bolt ? await getBoltId(bolt) : null;

      const existing = await queryRunner.query(`
        SELECT id FROM flange_dimensions
        WHERE "nominalOutsideDiameterId" = ${nominalId}
          AND "standardId" = ${asmeB165Id}
          AND "pressureClassId" = ${pressureClassId}
          AND "flangeTypeId" = ${typeId}
      `);

      if (existing.length > 0) {
        await queryRunner.query(`
          UPDATE flange_dimensions SET
            "D" = ${D}, "b" = ${b}, "d4" = ${d4}, "f" = ${f},
            "num_holes" = ${holes}, "d1" = ${d1},
            "boltId" = ${boltId || 'NULL'}, "pcd" = ${pcd}, "mass_kg" = ${mass}
          WHERE id = ${existing[0].id}
        `);
      } else {
        await queryRunner.query(`
          INSERT INTO flange_dimensions (
            "nominalOutsideDiameterId", "standardId", "pressureClassId", "flangeTypeId",
            "D", "b", "d4", "f", "num_holes", "d1", "boltId", "pcd", "mass_kg"
          ) VALUES (
            ${nominalId}, ${asmeB165Id}, ${pressureClassId}, ${typeId},
            ${D}, ${b}, ${d4}, ${f}, ${holes}, ${d1}, ${boltId || 'NULL'}, ${pcd}, ${mass}
          )
        `);
      }
      insertedCount++;
    }

    console.warn(`ASME B16.5 flange data migration complete: ${insertedCount} records added/updated, ${skippedCount} skipped`);
  }

  public async down(queryRunner: QueryRunner): Promise<void> {
    const asmeB165Id = 4;

    await queryRunner.query(`
      DELETE FROM flange_dimensions
      WHERE "standardId" = ${asmeB165Id} AND "flangeTypeId" IS NOT NULL
    `);

    await queryRunner.query(`
      DELETE FROM flange_pressure_classes
      WHERE "standardId" = ${asmeB165Id}
        AND designation ~ '^[0-9]+/[238]$'
    `);

    console.warn('ASME B16.5 comprehensive flange data removed');
  }
}
