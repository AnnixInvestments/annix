import { MigrationInterface, QueryRunner } from "typeorm";

export class AddComprehensiveBs4504FlangeData1770200000000 implements MigrationInterface {
  name = "AddComprehensiveBs4504FlangeData1770200000000";

  public async up(queryRunner: QueryRunner): Promise<void> {
    console.warn("Adding comprehensive BS 4504 flange data with all types...");

    const bs4504Id = 1;

    const getTypeId = async (code: string) => {
      const result = await queryRunner.query(`SELECT id FROM flange_types WHERE code = '${code}'`);
      return result[0]?.id;
    };

    const typeIds = {
      "/1": await getTypeId("/1"),
      "/2": await getTypeId("/2"),
      "/3": await getTypeId("/3"),
      "/4": await getTypeId("/4"),
      "/5": await getTypeId("/5"),
      "/6": await getTypeId("/6"),
      "/7": await getTypeId("/7"),
      "/8": await getTypeId("/8"),
    };

    const pressureValues = [6, 10, 16, 25, 40, 64, 100, 160];
    const flangeTypeCodes = ["/1", "/2", "/3", "/4", "/5", "/6", "/7", "/8"];

    for (const pressure of pressureValues) {
      for (const typeCode of flangeTypeCodes) {
        const designation = `${pressure}${typeCode}`;
        const existing = await queryRunner.query(`
          SELECT id FROM flange_pressure_classes
          WHERE designation = '${designation}' AND "standardId" = ${bs4504Id}
        `);
        if (existing.length === 0) {
          await queryRunner.query(`
            INSERT INTO flange_pressure_classes (designation, "standardId")
            VALUES ('${designation}', ${bs4504Id})
          `);
        }
      }
    }

    const getNominalId = async (nominalMm: number) => {
      const result = await queryRunner.query(`
        SELECT id FROM nominal_outside_diameters
        WHERE nominal_diameter_mm = ${nominalMm}
        LIMIT 1
      `);
      return result[0]?.id;
    };

    const getPressureClassId = async (designation: string) => {
      const result = await queryRunner.query(`
        SELECT id FROM flange_pressure_classes
        WHERE designation = '${designation}' AND "standardId" = ${bs4504Id}
      `);
      return result[0]?.id;
    };

    const getBoltId = async (designation: string) => {
      if (!designation) return null;
      const result = await queryRunner.query(
        `SELECT id FROM bolts WHERE designation = '${designation}'`,
      );
      return result[0]?.id;
    };

    // BS 4504 flange dimension data
    // Format: [NB, type, pressureClass, D, b, d4, f, holes, d1, bolt, pcd, mass, boltLength]
    // BS 4504 uses PN ratings: 6, 10, 16, 25, 40, 64, 100, 160
    // Dimensions based on BS 4504 / EN 1092-1 standard

    const flangeData: Array<
      [
        number,
        string,
        number,
        number,
        number,
        number,
        number,
        number,
        number,
        string | null,
        number,
        number,
        number,
      ]
    > = [
      // ===== 15NB (21.3 OD) =====
      // PN6
      [15, "/2", 6, 80, 12, 26, 2, 4, 11, "M10", 55, 0.4, 35],
      [15, "/3", 6, 80, 10, 26, 2, 4, 11, "M10", 55, 0.29, 30],
      [15, "/1", 6, 80, 6, 26, 2, 4, 11, "M10", 55, 0.18, 25],
      [15, "/8", 6, 80, 10, 0, 2, 4, 11, "M10", 55, 0.44, 30],
      // PN10
      [15, "/2", 10, 95, 14, 26, 2, 4, 14, "M12", 65, 0.67, 45],
      [15, "/3", 10, 95, 10, 26, 2, 4, 14, "M12", 65, 0.42, 35],
      [15, "/1", 10, 95, 8, 26, 2, 4, 14, "M12", 65, 0.32, 30],
      [15, "/8", 10, 95, 12, 0, 2, 4, 14, "M12", 65, 0.67, 40],
      // PN16
      [15, "/2", 16, 95, 14, 26, 2, 4, 14, "M12", 65, 0.67, 45],
      [15, "/3", 16, 95, 10, 26, 2, 4, 14, "M12", 65, 0.42, 35],
      [15, "/1", 16, 95, 8, 26, 2, 4, 14, "M12", 65, 0.32, 30],
      [15, "/8", 16, 95, 14, 0, 2, 4, 14, "M12", 65, 0.81, 45],
      // PN25
      [15, "/2", 25, 95, 16, 26, 2, 4, 14, "M12", 65, 0.75, 50],
      [15, "/3", 25, 95, 14, 26, 2, 4, 14, "M12", 65, 0.6, 45],
      [15, "/8", 25, 95, 16, 0, 2, 4, 14, "M12", 65, 0.95, 50],
      // PN40
      [15, "/2", 40, 95, 18, 26, 2, 4, 14, "M12", 65, 0.85, 55],
      [15, "/3", 40, 95, 14, 26, 2, 4, 14, "M12", 65, 0.6, 45],
      [15, "/8", 40, 95, 18, 0, 2, 4, 14, "M12", 65, 1.1, 55],

      // ===== 20NB (26.9 OD) =====
      // PN6
      [20, "/2", 6, 90, 14, 33, 2, 4, 11, "M10", 65, 0.59, 40],
      [20, "/3", 6, 90, 10, 33, 2, 4, 11, "M10", 65, 0.38, 30],
      [20, "/1", 6, 90, 6, 33, 2, 4, 11, "M10", 65, 0.24, 25],
      [20, "/8", 6, 90, 12, 0, 2, 4, 11, "M10", 65, 0.59, 35],
      // PN10
      [20, "/2", 10, 105, 16, 33, 2, 4, 14, "M12", 75, 0.94, 50],
      [20, "/3", 10, 105, 10, 33, 2, 4, 14, "M12", 75, 0.53, 35],
      [20, "/1", 10, 105, 8, 33, 2, 4, 14, "M12", 75, 0.4, 30],
      [20, "/8", 10, 105, 14, 0, 2, 4, 14, "M12", 75, 0.94, 45],
      // PN16
      [20, "/2", 16, 105, 16, 33, 2, 4, 14, "M12", 75, 0.94, 50],
      [20, "/3", 16, 105, 10, 33, 2, 4, 14, "M12", 75, 0.53, 35],
      [20, "/1", 16, 105, 8, 33, 2, 4, 14, "M12", 75, 0.4, 30],
      [20, "/8", 16, 105, 16, 0, 2, 4, 14, "M12", 75, 1.1, 50],
      // PN25
      [20, "/2", 25, 105, 18, 33, 2, 4, 14, "M12", 75, 1.1, 55],
      [20, "/3", 25, 105, 14, 33, 2, 4, 14, "M12", 75, 0.75, 45],
      [20, "/8", 25, 105, 18, 0, 2, 4, 14, "M12", 75, 1.3, 55],
      // PN40
      [20, "/2", 40, 105, 20, 33, 2, 4, 14, "M12", 75, 1.25, 60],
      [20, "/3", 40, 105, 14, 33, 2, 4, 14, "M12", 75, 0.75, 45],
      [20, "/8", 40, 105, 20, 0, 2, 4, 14, "M12", 75, 1.5, 60],

      // ===== 25NB (33.7 OD) =====
      // PN6
      [25, "/2", 6, 100, 14, 40, 2, 4, 11, "M10", 75, 0.72, 40],
      [25, "/3", 6, 100, 10, 40, 2, 4, 11, "M10", 75, 0.48, 30],
      [25, "/1", 6, 100, 6, 40, 2, 4, 11, "M10", 75, 0.3, 25],
      [25, "/8", 6, 100, 12, 0, 2, 4, 11, "M10", 75, 0.72, 35],
      // PN10
      [25, "/2", 10, 115, 16, 40, 2, 4, 14, "M12", 85, 1.11, 50],
      [25, "/3", 10, 115, 10, 40, 2, 4, 14, "M12", 85, 0.63, 35],
      [25, "/1", 10, 115, 8, 40, 2, 4, 14, "M12", 85, 0.48, 30],
      [25, "/8", 10, 115, 14, 0, 2, 4, 14, "M12", 85, 1.11, 45],
      // PN16
      [25, "/2", 16, 115, 16, 40, 2, 4, 14, "M12", 85, 1.11, 50],
      [25, "/3", 16, 115, 10, 40, 2, 4, 14, "M12", 85, 0.63, 35],
      [25, "/1", 16, 115, 8, 40, 2, 4, 14, "M12", 85, 0.48, 30],
      [25, "/8", 16, 115, 16, 0, 2, 4, 14, "M12", 85, 1.3, 50],
      // PN25
      [25, "/2", 25, 115, 20, 40, 2, 4, 14, "M12", 85, 1.45, 60],
      [25, "/3", 25, 115, 16, 40, 2, 4, 14, "M12", 85, 1.07, 50],
      [25, "/8", 25, 115, 20, 0, 2, 4, 14, "M12", 85, 1.5, 60],
      // PN40
      [25, "/2", 40, 115, 22, 40, 2, 4, 14, "M12", 85, 1.6, 65],
      [25, "/3", 40, 115, 16, 40, 2, 4, 14, "M12", 85, 1.07, 50],
      [25, "/8", 40, 115, 22, 0, 2, 4, 14, "M12", 85, 1.8, 65],

      // ===== 32NB (42.4 OD) =====
      // PN6
      [32, "/2", 6, 120, 14, 50, 2, 4, 14, "M12", 90, 0.97, 40],
      [32, "/3", 6, 120, 10, 50, 2, 4, 14, "M12", 90, 0.65, 30],
      [32, "/1", 6, 120, 6, 50, 2, 4, 14, "M12", 90, 0.4, 25],
      [32, "/8", 6, 120, 14, 0, 2, 4, 14, "M12", 90, 1.16, 40],
      // PN10
      [32, "/2", 10, 140, 18, 50, 2, 4, 18, "M16", 100, 1.82, 55],
      [32, "/3", 10, 140, 12, 50, 2, 4, 18, "M16", 100, 1.1, 40],
      [32, "/1", 10, 140, 10, 50, 2, 4, 18, "M16", 100, 0.88, 35],
      [32, "/8", 10, 140, 16, 0, 2, 4, 18, "M16", 100, 1.82, 50],
      // PN16
      [32, "/2", 16, 140, 18, 50, 2, 4, 18, "M16", 100, 1.82, 55],
      [32, "/3", 16, 140, 12, 50, 2, 4, 18, "M16", 100, 1.1, 40],
      [32, "/1", 16, 140, 10, 50, 2, 4, 18, "M16", 100, 0.88, 35],
      [32, "/8", 16, 140, 18, 0, 2, 4, 18, "M16", 100, 2.2, 55],
      // PN25
      [32, "/2", 25, 140, 22, 50, 2, 4, 18, "M16", 100, 2.4, 65],
      [32, "/3", 25, 140, 16, 50, 2, 4, 18, "M16", 100, 1.55, 50],
      [32, "/8", 25, 140, 22, 0, 2, 4, 18, "M16", 100, 2.6, 65],
      // PN40
      [32, "/2", 40, 140, 26, 50, 2, 4, 18, "M16", 100, 2.9, 75],
      [32, "/3", 40, 140, 18, 50, 2, 4, 18, "M16", 100, 1.8, 55],
      [32, "/8", 40, 140, 26, 0, 2, 4, 18, "M16", 100, 3.0, 75],

      // ===== 40NB (48.3 OD) =====
      // PN6
      [40, "/2", 6, 130, 14, 56, 2, 4, 14, "M12", 100, 1.16, 40],
      [40, "/3", 6, 130, 10, 56, 2, 4, 14, "M12", 100, 0.75, 30],
      [40, "/1", 6, 130, 6, 56, 2, 4, 14, "M12", 100, 0.46, 25],
      [40, "/8", 6, 130, 14, 0, 2, 4, 14, "M12", 100, 1.35, 40],
      // PN10
      [40, "/2", 10, 150, 18, 56, 2, 4, 18, "M16", 110, 2.08, 55],
      [40, "/3", 10, 150, 12, 56, 2, 4, 18, "M16", 110, 1.25, 40],
      [40, "/1", 10, 150, 10, 56, 2, 4, 18, "M16", 110, 1.0, 35],
      [40, "/8", 10, 150, 16, 0, 2, 4, 18, "M16", 110, 2.08, 50],
      // PN16
      [40, "/2", 16, 150, 18, 56, 2, 4, 18, "M16", 110, 2.08, 55],
      [40, "/3", 16, 150, 12, 56, 2, 4, 18, "M16", 110, 1.25, 40],
      [40, "/1", 16, 150, 10, 56, 2, 4, 18, "M16", 110, 1.0, 35],
      [40, "/8", 16, 150, 18, 0, 2, 4, 18, "M16", 110, 2.5, 55],
      // PN25
      [40, "/2", 25, 150, 22, 56, 2, 4, 18, "M16", 110, 2.7, 65],
      [40, "/3", 25, 150, 16, 56, 2, 4, 18, "M16", 110, 1.8, 50],
      [40, "/8", 25, 150, 22, 0, 2, 4, 18, "M16", 110, 3.0, 65],
      // PN40
      [40, "/2", 40, 150, 26, 56, 2, 4, 18, "M16", 110, 3.3, 75],
      [40, "/3", 40, 150, 18, 56, 2, 4, 18, "M16", 110, 2.1, 55],
      [40, "/8", 40, 150, 26, 0, 2, 4, 18, "M16", 110, 3.5, 75],

      // ===== 50NB (60.3 OD) =====
      // PN6
      [50, "/2", 6, 140, 16, 66, 3, 4, 14, "M12", 110, 1.48, 45],
      [50, "/3", 6, 140, 10, 66, 3, 4, 14, "M12", 110, 0.9, 30],
      [50, "/1", 6, 140, 8, 66, 3, 4, 14, "M12", 110, 0.7, 25],
      [50, "/8", 6, 140, 14, 0, 3, 4, 14, "M12", 110, 1.9, 40],
      // PN10
      [50, "/2", 10, 165, 20, 66, 3, 4, 18, "M16", 125, 2.73, 60],
      [50, "/3", 10, 165, 12, 66, 3, 4, 18, "M16", 125, 1.5, 40],
      [50, "/1", 10, 165, 10, 66, 3, 4, 18, "M16", 125, 1.2, 35],
      [50, "/8", 10, 165, 18, 0, 3, 4, 18, "M16", 125, 2.7, 55],
      // PN16
      [50, "/2", 16, 165, 20, 66, 3, 4, 18, "M16", 125, 2.73, 60],
      [50, "/3", 16, 165, 12, 66, 3, 4, 18, "M16", 125, 1.5, 40],
      [50, "/1", 16, 165, 10, 66, 3, 4, 18, "M16", 125, 1.2, 35],
      [50, "/8", 16, 165, 20, 0, 3, 4, 18, "M16", 125, 3.3, 60],
      // PN25
      [50, "/2", 25, 165, 26, 66, 3, 4, 18, "M16", 125, 3.8, 75],
      [50, "/3", 25, 165, 18, 66, 3, 4, 18, "M16", 125, 2.4, 55],
      [50, "/8", 25, 165, 26, 0, 3, 4, 18, "M16", 125, 4.0, 75],
      // PN40
      [50, "/2", 40, 165, 30, 66, 3, 4, 18, "M16", 125, 4.6, 85],
      [50, "/3", 40, 165, 20, 66, 3, 4, 18, "M16", 125, 2.8, 60],
      [50, "/8", 40, 165, 30, 0, 3, 4, 18, "M16", 125, 4.8, 85],

      // ===== 65NB (76.1 OD) =====
      // PN6
      [65, "/2", 6, 160, 16, 82, 3, 4, 14, "M12", 130, 1.86, 45],
      [65, "/3", 6, 160, 10, 82, 3, 4, 14, "M12", 130, 1.1, 30],
      [65, "/1", 6, 160, 8, 82, 3, 4, 14, "M12", 130, 0.85, 25],
      [65, "/8", 6, 160, 14, 0, 3, 4, 14, "M12", 130, 2.5, 40],
      // PN10
      [65, "/2", 10, 185, 22, 82, 3, 8, 18, "M16", 145, 3.48, 65],
      [65, "/3", 10, 185, 12, 82, 3, 8, 18, "M16", 145, 1.8, 40],
      [65, "/1", 10, 185, 10, 82, 3, 8, 18, "M16", 145, 1.45, 35],
      [65, "/8", 10, 185, 18, 0, 3, 8, 18, "M16", 145, 3.5, 55],
      // PN16
      [65, "/2", 16, 185, 22, 82, 3, 8, 18, "M16", 145, 3.48, 65],
      [65, "/3", 16, 185, 12, 82, 3, 8, 18, "M16", 145, 1.8, 40],
      [65, "/1", 16, 185, 10, 82, 3, 8, 18, "M16", 145, 1.45, 35],
      [65, "/8", 16, 185, 22, 0, 3, 8, 18, "M16", 145, 4.2, 65],
      // PN25
      [65, "/2", 25, 185, 28, 82, 3, 8, 18, "M16", 145, 4.8, 80],
      [65, "/3", 25, 185, 20, 82, 3, 8, 18, "M16", 145, 3.1, 60],
      [65, "/8", 25, 185, 28, 0, 3, 8, 18, "M16", 145, 5.5, 80],
      // PN40
      [65, "/2", 40, 185, 34, 82, 3, 8, 18, "M16", 145, 6.2, 95],
      [65, "/3", 40, 185, 24, 82, 3, 8, 18, "M16", 145, 4.0, 70],
      [65, "/8", 40, 185, 34, 0, 3, 8, 18, "M16", 145, 6.5, 95],

      // ===== 80NB (88.9 OD) =====
      // PN6
      [80, "/2", 6, 190, 18, 95, 3, 4, 18, "M16", 150, 2.95, 55],
      [80, "/3", 6, 190, 12, 95, 3, 4, 18, "M16", 150, 1.8, 40],
      [80, "/1", 6, 190, 10, 95, 3, 4, 18, "M16", 150, 1.45, 35],
      [80, "/8", 6, 190, 16, 0, 3, 4, 18, "M16", 150, 3.8, 50],
      // PN10
      [80, "/2", 10, 200, 22, 95, 3, 8, 18, "M16", 160, 4.32, 65],
      [80, "/3", 10, 200, 14, 95, 3, 8, 18, "M16", 160, 2.5, 45],
      [80, "/1", 10, 200, 12, 95, 3, 8, 18, "M16", 160, 2.1, 40],
      [80, "/8", 10, 200, 18, 0, 3, 8, 18, "M16", 160, 4.5, 55],
      // PN16
      [80, "/2", 16, 200, 22, 95, 3, 8, 18, "M16", 160, 4.32, 65],
      [80, "/3", 16, 200, 14, 95, 3, 8, 18, "M16", 160, 2.5, 45],
      [80, "/1", 16, 200, 12, 95, 3, 8, 18, "M16", 160, 2.1, 40],
      [80, "/8", 16, 200, 22, 0, 3, 8, 18, "M16", 160, 5.4, 65],
      // PN25
      [80, "/2", 25, 200, 28, 95, 3, 8, 18, "M16", 160, 6.0, 80],
      [80, "/3", 25, 200, 20, 95, 3, 8, 18, "M16", 160, 4.0, 60],
      [80, "/8", 25, 200, 28, 0, 3, 8, 18, "M16", 160, 7.0, 80],
      // PN40
      [80, "/2", 40, 200, 34, 95, 3, 8, 18, "M16", 160, 7.8, 95],
      [80, "/3", 40, 200, 24, 95, 3, 8, 18, "M16", 160, 5.2, 70],
      [80, "/8", 40, 200, 34, 0, 3, 8, 18, "M16", 160, 8.5, 95],

      // ===== 100NB (114.3 OD) =====
      // PN6
      [100, "/2", 6, 210, 18, 121, 3, 8, 18, "M16", 170, 3.26, 55],
      [100, "/3", 6, 210, 12, 121, 3, 8, 18, "M16", 170, 2.0, 40],
      [100, "/1", 6, 210, 10, 121, 3, 8, 18, "M16", 170, 1.6, 35],
      [100, "/8", 6, 210, 16, 0, 3, 8, 18, "M16", 170, 4.8, 50],
      // PN10
      [100, "/2", 10, 220, 24, 121, 3, 8, 18, "M16", 180, 6.07, 70],
      [100, "/3", 10, 220, 14, 121, 3, 8, 18, "M16", 180, 3.3, 45],
      [100, "/1", 10, 220, 12, 121, 3, 8, 18, "M16", 180, 2.75, 40],
      [100, "/8", 10, 220, 20, 0, 3, 8, 18, "M16", 180, 5.8, 60],
      // PN16
      [100, "/2", 16, 235, 26, 121, 3, 8, 22, "M20", 190, 7.2, 75],
      [100, "/3", 16, 235, 16, 121, 3, 8, 22, "M20", 190, 4.2, 50],
      [100, "/1", 16, 235, 14, 121, 3, 8, 22, "M20", 190, 3.6, 45],
      [100, "/8", 16, 235, 22, 0, 3, 8, 22, "M20", 190, 7.2, 65],
      // PN25
      [100, "/2", 25, 250, 32, 121, 3, 8, 26, "M24", 200, 9.5, 90],
      [100, "/3", 25, 250, 22, 121, 3, 8, 26, "M24", 200, 6.2, 65],
      [100, "/8", 25, 250, 32, 0, 3, 8, 26, "M24", 200, 9.5, 90],
      // PN40
      [100, "/2", 40, 265, 40, 121, 3, 8, 30, "M27", 212, 12.0, 110],
      [100, "/3", 40, 265, 28, 121, 3, 8, 30, "M27", 212, 8.0, 80],
      [100, "/8", 40, 265, 40, 0, 3, 8, 30, "M27", 212, 12.0, 110],

      // ===== 125NB (139.7 OD) =====
      // PN10
      [125, "/2", 10, 250, 26, 146, 3, 8, 18, "M16", 210, 8.5, 75],
      [125, "/3", 10, 250, 16, 146, 3, 8, 18, "M16", 210, 4.8, 50],
      [125, "/1", 10, 250, 14, 146, 3, 8, 18, "M16", 210, 4.1, 45],
      [125, "/8", 10, 250, 22, 0, 3, 8, 18, "M16", 210, 8.5, 65],
      // PN16
      [125, "/2", 16, 270, 28, 146, 3, 8, 22, "M20", 220, 10.5, 80],
      [125, "/3", 16, 270, 18, 146, 3, 8, 22, "M20", 220, 6.2, 55],
      [125, "/1", 16, 270, 16, 146, 3, 8, 22, "M20", 220, 5.4, 50],
      [125, "/8", 16, 270, 24, 0, 3, 8, 22, "M20", 220, 10.5, 70],

      // ===== 150NB (168.3 OD) =====
      // PN6
      [150, "/2", 6, 265, 20, 176, 3, 8, 18, "M16", 225, 4.76, 60],
      [150, "/3", 6, 265, 12, 176, 3, 8, 18, "M16", 225, 2.8, 40],
      [150, "/1", 6, 265, 10, 176, 3, 8, 18, "M16", 225, 2.25, 35],
      [150, "/8", 6, 265, 18, 0, 3, 8, 18, "M16", 225, 7.5, 55],
      // PN10
      [150, "/2", 10, 285, 26, 176, 3, 8, 22, "M20", 240, 10.3, 75],
      [150, "/3", 10, 285, 16, 176, 3, 8, 22, "M20", 240, 5.8, 50],
      [150, "/1", 10, 285, 14, 176, 3, 8, 22, "M20", 240, 5.0, 45],
      [150, "/8", 10, 285, 22, 0, 3, 8, 22, "M20", 240, 10.0, 65],
      // PN16
      [150, "/2", 16, 300, 30, 176, 3, 8, 26, "M24", 250, 13.2, 85],
      [150, "/3", 16, 300, 18, 176, 3, 8, 26, "M24", 250, 7.5, 55],
      [150, "/1", 16, 300, 16, 176, 3, 8, 26, "M24", 250, 6.6, 50],
      [150, "/8", 16, 300, 26, 0, 3, 8, 26, "M24", 250, 13.2, 75],
      // PN25
      [150, "/2", 25, 340, 42, 176, 4, 12, 30, "M27", 280, 20.0, 115],
      [150, "/3", 25, 340, 28, 176, 4, 12, 30, "M27", 280, 12.5, 80],
      [150, "/8", 25, 340, 42, 0, 4, 12, 30, "M27", 280, 18.0, 115],
      // PN40
      [150, "/2", 40, 355, 52, 176, 4, 12, 33, "M30", 295, 26.0, 140],
      [150, "/3", 40, 355, 36, 176, 4, 12, 33, "M30", 295, 17.0, 100],
      [150, "/8", 40, 355, 52, 0, 4, 12, 33, "M30", 295, 23.0, 140],

      // ===== 200NB (219.1 OD) =====
      // PN6
      [200, "/2", 6, 320, 22, 229, 3, 8, 18, "M16", 280, 6.88, 65],
      [200, "/3", 6, 320, 14, 229, 3, 8, 18, "M16", 280, 4.2, 45],
      [200, "/1", 6, 320, 12, 229, 3, 8, 18, "M16", 280, 3.5, 40],
      [200, "/8", 6, 320, 20, 0, 3, 8, 18, "M16", 280, 11.5, 60],
      // PN10
      [200, "/2", 10, 340, 30, 229, 3, 12, 22, "M20", 295, 17.9, 85],
      [200, "/3", 10, 340, 18, 229, 3, 12, 22, "M20", 295, 9.7, 55],
      [200, "/1", 10, 340, 16, 229, 3, 12, 22, "M20", 295, 8.5, 50],
      [200, "/8", 10, 340, 26, 0, 3, 12, 22, "M20", 295, 16.5, 75],
      // PN16
      [200, "/2", 16, 360, 36, 229, 3, 12, 26, "M24", 310, 24.0, 100],
      [200, "/3", 16, 360, 22, 229, 3, 12, 26, "M24", 310, 14.0, 65],
      [200, "/1", 16, 360, 20, 229, 3, 12, 26, "M24", 310, 12.5, 60],
      [200, "/8", 16, 360, 32, 0, 3, 12, 26, "M24", 310, 20.0, 90],
      // PN25
      [200, "/2", 25, 405, 50, 229, 4, 12, 33, "M30", 345, 37.0, 135],
      [200, "/3", 25, 405, 34, 229, 4, 12, 33, "M30", 345, 24.0, 95],
      [200, "/8", 25, 405, 50, 0, 4, 12, 33, "M30", 345, 30.0, 135],
      // PN40
      [200, "/2", 40, 430, 62, 229, 4, 12, 36, "M33", 365, 50.0, 165],
      [200, "/3", 40, 430, 42, 229, 4, 12, 36, "M33", 365, 32.0, 115],
      [200, "/8", 40, 430, 62, 0, 4, 12, 36, "M33", 365, 40.0, 165],

      // ===== 250NB (273.0 OD) =====
      // PN6
      [250, "/2", 6, 375, 24, 284, 3, 12, 18, "M16", 335, 8.92, 70],
      [250, "/3", 6, 375, 16, 284, 3, 12, 18, "M16", 335, 5.6, 50],
      [250, "/1", 6, 375, 14, 284, 3, 12, 18, "M16", 335, 4.8, 45],
      [250, "/8", 6, 375, 22, 0, 3, 12, 18, "M16", 335, 17.0, 65],
      // PN10
      [250, "/2", 10, 405, 34, 284, 3, 12, 26, "M24", 355, 29.3, 95],
      [250, "/3", 10, 405, 20, 284, 3, 12, 26, "M24", 355, 15.9, 60],
      [250, "/1", 10, 405, 18, 284, 3, 12, 26, "M24", 355, 14.1, 55],
      [250, "/8", 10, 405, 30, 0, 3, 12, 26, "M24", 355, 25.0, 85],
      // PN16
      [250, "/2", 16, 425, 42, 284, 3, 12, 30, "M27", 370, 38.0, 115],
      [250, "/3", 16, 425, 26, 284, 3, 12, 30, "M27", 370, 22.5, 75],
      [250, "/1", 16, 425, 24, 284, 3, 12, 30, "M27", 370, 20.5, 70],
      [250, "/8", 16, 425, 38, 0, 3, 12, 30, "M27", 370, 32.0, 105],
      // PN25
      [250, "/2", 25, 470, 56, 284, 4, 12, 36, "M33", 410, 55.0, 150],
      [250, "/3", 25, 470, 38, 284, 4, 12, 36, "M33", 410, 35.0, 105],
      [250, "/8", 25, 470, 56, 0, 4, 12, 36, "M33", 410, 48.0, 150],
      // PN40
      [250, "/2", 40, 505, 70, 284, 4, 12, 39, "M36", 440, 75.0, 185],
      [250, "/3", 40, 505, 48, 284, 4, 12, 39, "M36", 440, 48.0, 130],
      [250, "/8", 40, 505, 70, 0, 4, 12, 39, "M36", 440, 65.0, 185],

      // ===== 300NB (323.9 OD) =====
      // PN6
      [300, "/2", 6, 440, 26, 337, 4, 12, 22, "M20", 395, 11.9, 75],
      [300, "/3", 6, 440, 16, 337, 4, 12, 22, "M20", 395, 7.0, 50],
      [300, "/1", 6, 440, 14, 337, 4, 12, 22, "M20", 395, 6.0, 45],
      [300, "/8", 6, 440, 24, 0, 4, 12, 22, "M20", 395, 24.0, 70],
      // PN10
      [300, "/2", 10, 460, 38, 337, 4, 12, 26, "M24", 410, 43.8, 105],
      [300, "/3", 10, 460, 22, 337, 4, 12, 26, "M24", 410, 23.5, 65],
      [300, "/1", 10, 460, 20, 337, 4, 12, 26, "M24", 410, 21.0, 60],
      [300, "/8", 10, 460, 34, 0, 4, 12, 26, "M24", 410, 36.0, 95],
      // PN16
      [300, "/2", 16, 485, 48, 337, 4, 12, 30, "M27", 430, 60.0, 130],
      [300, "/3", 16, 485, 30, 337, 4, 12, 30, "M27", 430, 35.0, 85],
      [300, "/1", 16, 485, 28, 337, 4, 12, 30, "M27", 430, 32.5, 80],
      [300, "/8", 16, 485, 44, 0, 4, 12, 30, "M27", 430, 48.0, 120],
      // PN25
      [300, "/2", 25, 535, 64, 337, 4, 16, 36, "M33", 475, 85.0, 170],
      [300, "/3", 25, 535, 44, 337, 4, 16, 36, "M33", 475, 55.0, 120],
      [300, "/8", 25, 535, 64, 0, 4, 16, 36, "M33", 475, 72.0, 170],
      // PN40
      [300, "/2", 40, 585, 82, 337, 4, 16, 42, "M39", 515, 115.0, 215],
      [300, "/3", 40, 585, 56, 337, 4, 16, 42, "M39", 515, 75.0, 150],
      [300, "/8", 40, 585, 82, 0, 4, 16, 42, "M39", 515, 100.0, 215],

      // ===== 350NB (355.6 OD) =====
      // PN10
      [350, "/2", 10, 520, 42, 370, 4, 16, 26, "M24", 470, 61.5, 115],
      [350, "/3", 10, 520, 26, 370, 4, 16, 26, "M24", 470, 35.5, 75],
      [350, "/1", 10, 520, 24, 370, 4, 16, 26, "M24", 470, 32.5, 70],
      [350, "/8", 10, 520, 38, 0, 4, 16, 26, "M24", 470, 48.0, 105],
      // PN16
      [350, "/2", 16, 555, 54, 370, 4, 16, 33, "M30", 495, 85.0, 145],
      [350, "/3", 16, 555, 34, 370, 4, 16, 33, "M30", 495, 50.0, 95],
      [350, "/1", 16, 555, 32, 370, 4, 16, 33, "M30", 495, 46.5, 90],
      [350, "/8", 16, 555, 50, 0, 4, 16, 33, "M30", 495, 65.0, 135],

      // ===== 400NB (406.4 OD) =====
      // PN10
      [400, "/2", 10, 580, 46, 422, 4, 16, 30, "M27", 525, 88.5, 125],
      [400, "/3", 10, 580, 28, 422, 4, 16, 30, "M27", 525, 50.0, 80],
      [400, "/1", 10, 580, 26, 422, 4, 16, 30, "M27", 525, 46.0, 75],
      [400, "/8", 10, 580, 42, 0, 4, 16, 30, "M27", 525, 62.0, 115],
      // PN16
      [400, "/2", 16, 620, 60, 422, 4, 16, 36, "M33", 555, 120.0, 160],
      [400, "/3", 16, 620, 38, 422, 4, 16, 36, "M33", 555, 70.0, 105],
      [400, "/1", 16, 620, 36, 422, 4, 16, 36, "M33", 555, 65.5, 100],
      [400, "/8", 16, 620, 56, 0, 4, 16, 36, "M33", 555, 85.0, 150],

      // ===== 450NB (457.2 OD) =====
      // PN10
      [450, "/2", 10, 640, 50, 474, 4, 20, 30, "M27", 585, 110.0, 135],
      [450, "/3", 10, 640, 32, 474, 4, 20, 30, "M27", 585, 65.0, 90],
      [450, "/1", 10, 640, 30, 474, 4, 20, 30, "M27", 585, 60.5, 85],
      [450, "/8", 10, 640, 46, 0, 4, 20, 30, "M27", 585, 78.0, 125],
      // PN16
      [450, "/2", 16, 685, 66, 474, 4, 20, 36, "M33", 620, 155.0, 175],
      [450, "/3", 16, 685, 42, 474, 4, 20, 36, "M33", 620, 90.0, 115],
      [450, "/1", 16, 685, 40, 474, 4, 20, 36, "M33", 620, 85.0, 110],
      [450, "/8", 16, 685, 62, 0, 4, 20, 36, "M33", 620, 108.0, 165],

      // ===== 500NB (508.0 OD) =====
      // PN10
      [500, "/2", 10, 715, 54, 525, 4, 20, 33, "M30", 650, 140.0, 145],
      [500, "/3", 10, 715, 34, 525, 4, 20, 33, "M30", 650, 80.0, 95],
      [500, "/1", 10, 715, 32, 525, 4, 20, 33, "M30", 650, 74.5, 90],
      [500, "/8", 10, 715, 50, 0, 4, 20, 33, "M30", 650, 95.0, 135],
      // PN16
      [500, "/2", 16, 755, 72, 525, 4, 20, 39, "M36", 685, 195.0, 190],
      [500, "/3", 16, 755, 46, 525, 4, 20, 39, "M36", 685, 115.0, 125],
      [500, "/1", 16, 755, 44, 525, 4, 20, 39, "M36", 685, 108.0, 120],
      [500, "/8", 16, 755, 68, 0, 4, 20, 39, "M36", 685, 135.0, 180],

      // ===== 600NB (609.6 OD) =====
      // PN10
      [600, "/2", 10, 840, 62, 630, 4, 20, 36, "M33", 770, 200.0, 165],
      [600, "/3", 10, 840, 40, 630, 4, 20, 36, "M33", 770, 120.0, 110],
      [600, "/1", 10, 840, 38, 630, 4, 20, 36, "M33", 770, 113.0, 105],
      [600, "/8", 10, 840, 58, 0, 4, 20, 36, "M33", 770, 135.0, 155],
      // PN16
      [600, "/2", 16, 890, 82, 630, 4, 20, 42, "M39", 810, 280.0, 215],
      [600, "/3", 16, 890, 52, 630, 4, 20, 42, "M39", 810, 165.0, 140],
      [600, "/1", 16, 890, 50, 630, 4, 20, 42, "M39", 810, 157.5, 135],
      [600, "/8", 16, 890, 78, 0, 4, 20, 42, "M39", 810, 195.0, 205],

      // ===== TYPE /4 THREADED FLANGES (up to 100NB) =====
      [15, "/4", 10, 95, 10, 26, 2, 4, 14, "M12", 65, 0.45, 35],
      [20, "/4", 10, 105, 10, 33, 2, 4, 14, "M12", 75, 0.55, 35],
      [25, "/4", 10, 115, 10, 40, 2, 4, 14, "M12", 85, 0.66, 35],
      [32, "/4", 10, 140, 12, 50, 2, 4, 18, "M16", 100, 1.15, 40],
      [40, "/4", 10, 150, 12, 56, 2, 4, 18, "M16", 110, 1.3, 40],
      [50, "/4", 10, 165, 12, 66, 3, 4, 18, "M16", 125, 1.55, 40],
      [65, "/4", 10, 185, 12, 82, 3, 8, 18, "M16", 145, 1.88, 40],
      [80, "/4", 10, 200, 14, 95, 3, 8, 18, "M16", 160, 2.55, 45],
      [100, "/4", 10, 220, 14, 121, 3, 8, 18, "M16", 180, 3.4, 45],
      [15, "/4", 16, 95, 10, 26, 2, 4, 14, "M12", 65, 0.45, 35],
      [20, "/4", 16, 105, 10, 33, 2, 4, 14, "M12", 75, 0.55, 35],
      [25, "/4", 16, 115, 10, 40, 2, 4, 14, "M12", 85, 0.66, 35],
      [32, "/4", 16, 140, 12, 50, 2, 4, 18, "M16", 100, 1.15, 40],
      [40, "/4", 16, 150, 12, 56, 2, 4, 18, "M16", 110, 1.3, 40],
      [50, "/4", 16, 165, 12, 66, 3, 4, 18, "M16", 125, 1.55, 40],
      [65, "/4", 16, 185, 12, 82, 3, 8, 18, "M16", 145, 1.88, 40],
      [80, "/4", 16, 200, 14, 95, 3, 8, 18, "M16", 160, 2.55, 45],
      [100, "/4", 16, 235, 16, 121, 3, 8, 22, "M20", 190, 4.3, 50],

      // ===== TYPE /6 SOCKET WELD FLANGES (up to 80NB) =====
      [15, "/6", 10, 95, 10, 26, 2, 4, 14, "M12", 65, 0.48, 35],
      [20, "/6", 10, 105, 10, 33, 2, 4, 14, "M12", 75, 0.58, 35],
      [25, "/6", 10, 115, 10, 40, 2, 4, 14, "M12", 85, 0.7, 35],
      [32, "/6", 10, 140, 12, 50, 2, 4, 18, "M16", 100, 1.2, 40],
      [40, "/6", 10, 150, 12, 56, 2, 4, 18, "M16", 110, 1.35, 40],
      [50, "/6", 10, 165, 12, 66, 3, 4, 18, "M16", 125, 1.6, 40],
      [65, "/6", 10, 185, 12, 82, 3, 8, 18, "M16", 145, 1.92, 40],
      [80, "/6", 10, 200, 14, 95, 3, 8, 18, "M16", 160, 2.6, 45],
      [15, "/6", 16, 95, 10, 26, 2, 4, 14, "M12", 65, 0.48, 35],
      [20, "/6", 16, 105, 10, 33, 2, 4, 14, "M12", 75, 0.58, 35],
      [25, "/6", 16, 115, 10, 40, 2, 4, 14, "M12", 85, 0.7, 35],
      [32, "/6", 16, 140, 12, 50, 2, 4, 18, "M16", 100, 1.2, 40],
      [40, "/6", 16, 150, 12, 56, 2, 4, 18, "M16", 110, 1.35, 40],
      [50, "/6", 16, 165, 12, 66, 3, 4, 18, "M16", 125, 1.6, 40],
      [65, "/6", 16, 185, 12, 82, 3, 8, 18, "M16", 145, 1.92, 40],
      [80, "/6", 16, 200, 14, 95, 3, 8, 18, "M16", 160, 2.6, 45],

      // ===== TYPE /7 HUBBED SLIP-ON FLANGES =====
      [15, "/7", 10, 95, 11, 26, 2, 4, 14, "M12", 65, 0.5, 38],
      [20, "/7", 10, 105, 11, 33, 2, 4, 14, "M12", 75, 0.62, 38],
      [25, "/7", 10, 115, 11, 40, 2, 4, 14, "M12", 85, 0.74, 38],
      [32, "/7", 10, 140, 13, 50, 2, 4, 18, "M16", 100, 1.25, 42],
      [40, "/7", 10, 150, 13, 56, 2, 4, 18, "M16", 110, 1.42, 42],
      [50, "/7", 10, 165, 13, 66, 3, 4, 18, "M16", 125, 1.68, 42],
      [65, "/7", 10, 185, 13, 82, 3, 8, 18, "M16", 145, 2.0, 42],
      [80, "/7", 10, 200, 15, 95, 3, 8, 18, "M16", 160, 2.75, 48],
      [100, "/7", 10, 220, 15, 121, 3, 8, 18, "M16", 180, 3.6, 48],
      [150, "/7", 10, 285, 17, 176, 3, 8, 22, "M20", 240, 6.4, 52],
      [200, "/7", 10, 340, 19, 229, 3, 12, 22, "M20", 295, 10.7, 58],
      [250, "/7", 10, 405, 21, 284, 3, 12, 26, "M24", 355, 17.5, 62],
      [300, "/7", 10, 460, 23, 337, 4, 12, 26, "M24", 410, 26.0, 68],
      [15, "/7", 16, 95, 11, 26, 2, 4, 14, "M12", 65, 0.5, 38],
      [20, "/7", 16, 105, 11, 33, 2, 4, 14, "M12", 75, 0.62, 38],
      [25, "/7", 16, 115, 11, 40, 2, 4, 14, "M12", 85, 0.74, 38],
      [32, "/7", 16, 140, 13, 50, 2, 4, 18, "M16", 100, 1.25, 42],
      [40, "/7", 16, 150, 13, 56, 2, 4, 18, "M16", 110, 1.42, 42],
      [50, "/7", 16, 165, 13, 66, 3, 4, 18, "M16", 125, 1.68, 42],
      [65, "/7", 16, 185, 13, 82, 3, 8, 18, "M16", 145, 2.0, 42],
      [80, "/7", 16, 200, 15, 95, 3, 8, 18, "M16", 160, 2.75, 48],
      [100, "/7", 16, 235, 17, 121, 3, 8, 22, "M20", 190, 4.6, 52],
      [150, "/7", 16, 300, 19, 176, 3, 8, 26, "M24", 250, 8.2, 58],
      [200, "/7", 16, 360, 23, 229, 3, 12, 26, "M24", 310, 15.4, 68],
      [250, "/7", 16, 425, 27, 284, 3, 12, 30, "M27", 370, 24.7, 78],
      [300, "/7", 16, 485, 31, 337, 4, 12, 30, "M27", 430, 38.5, 88],
    ];

    console.warn(`Inserting ${flangeData.length} BS 4504 flange dimension records...`);

    let insertedCount = 0;
    let skippedCount = 0;

    for (const flange of flangeData) {
      const [nominalMm, typeCode, pressure, D, b, d4, f, holes, d1, bolt, pcd, mass, _boltLength] =
        flange;

      const nominalId = await getNominalId(nominalMm);
      if (!nominalId) {
        console.warn(`Nominal size ${nominalMm}NB not found, skipping...`);
        skippedCount++;
        continue;
      }

      const typeId = typeIds[typeCode as keyof typeof typeIds];
      if (!typeId) {
        console.warn(`Flange type ${typeCode} not found, skipping...`);
        skippedCount++;
        continue;
      }

      const pressureClassDesignation = `${pressure}${typeCode}`;
      const pressureClassId = await getPressureClassId(pressureClassDesignation);
      if (!pressureClassId) {
        console.warn(`Pressure class ${pressureClassDesignation} not found, skipping...`);
        skippedCount++;
        continue;
      }

      const boltId = bolt ? await getBoltId(bolt) : null;

      const existing = await queryRunner.query(`
        SELECT id FROM flange_dimensions
        WHERE "nominalOutsideDiameterId" = ${nominalId}
          AND "standardId" = ${bs4504Id}
          AND "pressureClassId" = ${pressureClassId}
          AND "flangeTypeId" = ${typeId}
      `);

      if (existing.length > 0) {
        await queryRunner.query(`
          UPDATE flange_dimensions SET
            "D" = ${D}, "b" = ${b}, "d4" = ${d4}, "f" = ${f},
            "num_holes" = ${holes}, "d1" = ${d1},
            "boltId" = ${boltId || "NULL"}, "pcd" = ${pcd}, "mass_kg" = ${mass}
          WHERE id = ${existing[0].id}
        `);
      } else {
        await queryRunner.query(`
          INSERT INTO flange_dimensions (
            "nominalOutsideDiameterId", "standardId", "pressureClassId", "flangeTypeId",
            "D", "b", "d4", "f", "num_holes", "d1", "boltId", "pcd", "mass_kg"
          ) VALUES (
            ${nominalId}, ${bs4504Id}, ${pressureClassId}, ${typeId},
            ${D}, ${b}, ${d4}, ${f}, ${holes}, ${d1}, ${boltId || "NULL"}, ${pcd}, ${mass}
          )
        `);
      }
      insertedCount++;
    }

    // Add /5 (Slip-On Boss) derived from /3 data
    console.warn("Adding /5 Slip-On Boss flanges derived from /3...");
    await queryRunner.query(`
      INSERT INTO flange_dimensions ("nominalOutsideDiameterId", "standardId", "pressureClassId", "flangeTypeId", "D", "b", "d4", "f", "num_holes", "d1", "boltId", "pcd", "mass_kg")
      SELECT fd."nominalOutsideDiameterId", fd."standardId", pc5.id, 5, fd."D", fd.b + 2, fd.d4, fd.f, fd.num_holes, fd.d1, fd."boltId", fd.pcd, ROUND(CAST(fd.mass_kg * 1.15 AS numeric), 2)
      FROM flange_dimensions fd
      JOIN flange_pressure_classes pc3 ON fd."pressureClassId" = pc3.id
      JOIN flange_pressure_classes pc5 ON pc5.designation = CONCAT(SPLIT_PART(pc3.designation, '/', 1), '/5') AND pc5."standardId" = fd."standardId"
      WHERE fd."flangeTypeId" = 3 AND fd."standardId" = 1
    `);

    console.warn(
      `BS 4504 flange data migration complete: ${insertedCount} records added/updated, ${skippedCount} skipped`,
    );
  }

  public async down(queryRunner: QueryRunner): Promise<void> {
    const bs4504Id = 1;

    await queryRunner.query(`
      DELETE FROM flange_dimensions
      WHERE "standardId" = ${bs4504Id} AND "flangeTypeId" IS NOT NULL
    `);

    await queryRunner.query(`
      DELETE FROM flange_pressure_classes
      WHERE "standardId" = ${bs4504Id}
        AND designation ~ '^[0-9]+/[1-8]$'
    `);

    console.warn("BS 4504 comprehensive flange data removed");
  }
}
